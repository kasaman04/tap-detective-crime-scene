<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARæ¢åµ - ç¾å ´æ¤œè¨¼</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.0.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
    
    <!-- éŸ³éŸ¿åŠ¹æœç”¨ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« -->
    <audio id="bgm" loop preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcdBCGE0fPTgjMGHm/A7+CVSA0LVqzn77BdGAg+ltryxnkpBSl+zPLZizcIGGS57OihUgwMUKXh8bllHgg2jdXzzn0vBSF1xe/glEoODFOq5O+zYBoGPJPY88p9KwUme8rx3I4+CRZiturqpVUMC1Cn4u+4ZRwIOIzU8tGAMQYfcsLu45ZKDgxSqeTwsmEaCC=" type="audio/wav">
    </audio>
    
    <audio id="evidenceSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcdBCGE0fPTgjMGHm/A7+CVSA0LVqzn77BdGAg+ltryxnkpBSl+zPLZizcIGGS57OihUgwMUKXh8bllHgg2jdXzzn0vBSF1xe/glEoODFOq5O+zYBoGPJPY88p9KwUme8rx3I4+CRZiturqpVUMC1Cn4u+4ZRwIOIzU8tGAMQYfcsLu45ZKDgxSqeTwsmEaCC=" type="audio/wav">
    </audio>
    
    <audio id="scanSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcdBCGE0fPTgjMGHm/A7+CVSA0LVqzn77BdGAg+ltryxnkpBSl+zPLZizcIGGS57OihUgwMUKXh8bllHgg2jdXzzn0vBSF1xe/glEoODFOq5O+zYBoGPJPY88p9KwUme8rx3I4+CRZiturqpVUMC1Cn4u+4ZRwIOIzU8tGAMQYfcsLu45ZKDgxSqeTwsmEaCC=" type="audio/wav">
    </audio>
    
    <audio id="successSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcdBCGE0fPTgjMGHm/A7+CVSA0LVqzn77BdGAg+ltryxnkpBSl+zPLZizcIGGS57OihUgwMUKXh8bllHgg2jdXzzn0vBSF1xe/glEoODFOq5O+zYBoGPJPY88p9KwUme8rx3I4+CRZiturqpVUMC1Cn4u+4ZRwIOIzU8tGAMQYfcsLu45ZKDgxSqeTwsmEaCC=" type="audio/wav">
    </audio>
    
    <audio id="failSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmcdBCGE0fPTgjMGHm/A7+CVSA0LVqzn77BdGAg+ltryxnkpBSl+zPLZizcIGGS57OihUgwMUKXh8bllHgg2jdXzzn0vBSF1xe/glEoODFOq5O+zYBoGPJPY88p9KwUme8rx3I4+CRZiturqpVUMC1Cn4u+4ZRwIOIzU8tGAMQYfcsLu45ZKDgxSqeTwsmEaCC=" type="audio/wav">
    </audio>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', -apple-system, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
        }
        
        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        .title-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(to bottom, #000, #1a0000);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 1s ease;
        }
        
        .title-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        .game-title {
            font-size: 3rem;
            font-weight: bold;
            color: #ff0000;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .narration {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px 40px;
            border: 2px solid #ff0000;
            border-radius: 10px;
            font-size: 1.1rem;
            max-width: 80%;
            text-align: center;
            opacity: 0;
            animation: fadeIn 2s forwards;
            animation-delay: 1s;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .start-button {
            background: #ff0000;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeIn 2s forwards;
            animation-delay: 3s;
        }
        
        .start-button:hover {
            background: #cc0000;
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }
        
        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        .game-screen {
            display: none;
            position: relative;
            width: 100%;
            height: 100vh;
        }
        
        .game-screen.active {
            display: block;
        }
        
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* é«˜ç”»è³ªè¡¨ç¤ºè¨­å®š */
            image-rendering: auto;
            image-rendering: crisp-edges;
            image-rendering: -webkit-optimize-contrast;
            /* ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ç„¡åŠ¹åŒ–ã§é®®æ˜ã« */
            image-rendering: pixelated;
            /* WebKitç³»ã§ã®æœ€é©åŒ– */
            -webkit-backface-visibility: hidden;
            -webkit-transform: translateZ(0);
            /* ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ”¹å–„ */
            filter: contrast(1.1) brightness(1.05);
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            /* é«˜ç”»è³ªæç”»è¨­å®š */
            image-rendering: auto;
            image-rendering: crisp-edges;
            image-rendering: -webkit-optimize-contrast;
        }
        
        /* UIè¦ç´  */
        .game-ui {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }
        
        .evidence-counter {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid #ff0000;
            pointer-events: all;
        }
        
        .evidence-counter h3 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: #ff6666;
        }
        
        .evidence-list {
            position: absolute;
            top: 100px;
            left: 20px;
            max-width: 300px;
            max-height: 400px;
            overflow-y: auto;
            pointer-events: all;
        }
        
        .evidence-item {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #ff0000;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .evidence-item .object-name {
            color: #ff6666;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .evidence-item .hint {
            font-size: 0.9rem;
            color: #ddd;
            line-height: 1.4;
        }
        
        .scan-instructions {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            text-align: center;
            pointer-events: none;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }
        
        .tap-indicator {
            position: absolute;
            width: 50px;
            height: 50px;
            border: 3px solid #00ff00;
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            animation: tapRipple 0.6s ease-out forwards;
        }
        
        @keyframes tapRipple {
            0% {
                width: 10px;
                height: 10px;
                opacity: 1;
            }
            100% {
                width: 80px;
                height: 80px;
                opacity: 0;
            }
        }
        
        @keyframes scanPop {
            0% {
                transform: translate(-50%, -100%) scale(0.5);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -100%) scale(1.1);
                opacity: 1;
            }
            40% {
                transform: translate(-50%, -100%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -120%) scale(0.9);
                opacity: 0;
            }
        }
        
        @keyframes particleFall {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            50% {
                transform: translateY(-20px) scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: translateY(50px) scale(0.5);
                opacity: 0;
            }
        }
        
        @keyframes overlayFloat {
            0% {
                transform: translate(-50%, -100%) scale(0.8);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -100%) scale(1.05);
            }
            100% {
                transform: translate(-50%, -100%) scale(1);
                opacity: 1;
            }
        }
        
        @keyframes overlayFadeOut {
            0% {
                transform: translate(-50%, -100%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -100%) scale(0.8);
                opacity: 0;
            }
        }
        
        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        .game-screen {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #000;
            display: none;
        }
        
        .game-screen.active {
            display: block;
        }
        
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .game-ui {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }
        
        .evidence-counter {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ff0000;
            pointer-events: all;
            min-width: 200px;
        }
        
        .evidence-counter h3 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            color: #ff6666;
        }
        
        .evidence-counter #evidenceCount {
            font-size: 1.3rem;
            font-weight: bold;
            color: #00ff00;
        }
        
        .evidence-list {
            position: absolute;
            left: 20px;
            top: 150px;
            max-width: 300px;
            max-height: 300px;
            overflow-y: auto;
            pointer-events: all;
        }
        
        .evidence-item {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #ff0000;
            color: white;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            animation: slideIn 0.5s ease;
        }
        
        .evidence-item .object-name {
            color: #ff6666;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .evidence-item .hint {
            font-size: 0.9rem;
            color: #ddd;
            line-height: 1.4;
        }
        
        /* ã‚·ãƒŠãƒªã‚ªé¸æŠç”»é¢ */
        .scenario-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(to bottom, #1a0000, #000);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 90;
            padding: 20px;
        }
        
        .scenario-title {
            font-size: 2.5rem;
            color: #ff0000;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            text-align: center;
        }
        
        .scenario-subtitle {
            font-size: 1.1rem;
            color: #ccc;
            margin-bottom: 40px;
            text-align: center;
        }
        
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            max-width: 1000px;
            margin-bottom: 40px;
        }
        
        .scenario-card {
            background: rgba(20, 0, 0, 0.9);
            border: 2px solid #ff0000;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .scenario-card:hover {
            background: rgba(40, 0, 0, 0.95);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }
        
        .scenario-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .scenario-name {
            font-size: 1.4rem;
            color: #ff6666;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .scenario-description {
            font-size: 0.95rem;
            color: #ddd;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .scenario-difficulty {
            display: inline-block;
            background: rgba(255, 102, 102, 0.2);
            color: #ff6666;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: auto;
        }
        
        .back-to-title {
            background: #666;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .back-to-title:hover {
            background: #888;
            transform: scale(1.05);
        }
        
        /* æ¨ç†ãƒ•ã‚§ãƒ¼ã‚º */
        .deduction-phase {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            z-index: 200;
        }
        
        .deduction-phase.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .deduction-title {
            font-size: 2.5rem;
            color: #ff0000;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
        }
        
        .suspect-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 800px;
            margin-bottom: 30px;
        }
        
        .suspect-card {
            background: rgba(20, 0, 0, 0.9);
            border: 2px solid #ff0000;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .suspect-card:hover {
            background: rgba(50, 0, 0, 0.9);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }
        
        .suspect-name {
            font-size: 1.3rem;
            color: #ff6666;
            margin-bottom: 10px;
        }
        
        .suspect-description {
            font-size: 0.9rem;
            color: #ddd;
            line-height: 1.4;
        }
        
        /* çµæœç”»é¢ */
        .result-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #000;
            z-index: 300;
        }
        
        .result-screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .result-success {
            text-align: center;
        }
        
        .result-success h2 {
            font-size: 3rem;
            color: #00ff00;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
        }
        
        .result-fail {
            text-align: center;
        }
        
        .result-fail h2 {
            font-size: 3rem;
            color: #ff0000;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .result-message {
            font-size: 1.2rem;
            color: #ddd;
            margin-bottom: 30px;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .retry-button {
            background: #666;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .retry-button:hover {
            background: #888;
            transform: scale(1.05);
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #ff0000;
            text-align: center;
            display: none;
        }
        
        .loading.active {
            display: block;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 0, 0, 0.3);
            border-top: 3px solid #ff0000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* åŠ¹æœéŸ³é¢¨ãƒ†ã‚­ã‚¹ãƒˆ */
        .scan-effect {
            position: absolute;
            color: #00ff00;
            font-size: 1.5rem;
            font-weight: bold;
            pointer-events: none;
            animation: scanPulse 1s ease-out forwards;
        }
        
        @keyframes scanPulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 0;
            }
        }
        
        /* éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .volume-control {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 25px;
            border: 1px solid #ff0000;
            pointer-events: all;
        }
        
        .volume-control button {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .volume-control button:hover {
            background: rgba(255, 0, 0, 0.3);
        }
        
        .volume-control button.muted {
            color: #666;
        }
        
        /* ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ff0000;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-float 2s ease-out forwards;
        }
        
        @keyframes particle-float {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
    <div class="title-screen" id="titleScreen">
        <h1 class="game-title">ARæ¢åµ - ç¾å ´æ¤œè¨¼</h1>
        <div class="narration">
            äº‹ä»¶ç™ºç”Ÿã‹ã‚‰3æ™‚é–“...<br>
            ç¾å ´ã¯çŠ¯è¡Œå½“æ™‚ã®ã¾ã¾ä¿å­˜ã•ã‚Œã¦ã„ã‚‹<br>
            å›ã®æ¨ç†ã§çœŸå®Ÿã‚’æš´ã‘
        </div>
        <button class="start-button" onclick="showScenarioSelection()">ğŸšª äº‹ä»¶ç¾å ´ã¸</button>
        
        <!-- éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="volume-control">
            <button id="volumeBtn" onclick="toggleVolume()">ğŸ”Š</button>
            <span style="font-size: 0.8rem; color: #ccc;">éŸ³éŸ¿åŠ¹æœ</span>
        </div>
    </div>

    <!-- ã‚·ãƒŠãƒªã‚ªé¸æŠç”»é¢ -->
    <div class="scenario-screen" id="scenarioScreen" style="display: none;">
        <h2 class="scenario-title">äº‹ä»¶ã‚’é¸æŠã›ã‚ˆ</h2>
        <div class="scenario-subtitle">ã©ã®ç¾å ´ã‹ã‚‰æœæŸ»ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ</div>
        
        <div class="scenario-grid" id="scenarioGrid">
            <!-- ã‚·ãƒŠãƒªã‚ªã‚«ãƒ¼ãƒ‰ã¯å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        
        <button class="back-to-title" onclick="backToTitle()">â† ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div class="game-screen" id="gameScreen">
        <video id="video" autoplay muted playsinline></video>
        <canvas id="canvas"></canvas>
        
        <div class="game-ui">
            <div class="evidence-counter">
                <h3>ğŸ” åé›†ã—ãŸè¨¼æ‹ </h3>
                <div id="evidenceCount">0 / 5</div>
                <div style="font-size: 0.8rem; color: #888; margin-top: 5px;">
                    ç·‘: è¨¼æ‹ (æœ‰åŠ¹) | é»„: åé›†æ¸ˆã¿ | æ©™: è¨¼æ‹ (ä¸è¶³) | ç°: ä¸€èˆ¬
                </div>
            </div>
            
            <!-- éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆã‚²ãƒ¼ãƒ ç”»é¢ç”¨ï¼‰ -->
            <div class="volume-control">
                <button id="volumeBtn2" onclick="toggleVolume()">ğŸ”Š</button>
            </div>
            
            <div class="evidence-list" id="evidenceList"></div>
            
            <div class="scan-instructions">
                ğŸ“± ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ç‰©ä½“ã‚’æ¤œçŸ¥
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div>AIã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ä¸­...</div>
        </div>
    </div>

    <!-- æ¨ç†ãƒ•ã‚§ãƒ¼ã‚º -->
    <div class="deduction-phase" id="deductionPhase">
        <h2 class="deduction-title">çŠ¯äººã‚’æ¨ç†ã›ã‚ˆ</h2>
        <div class="suspect-list" id="suspectList"></div>
        <div style="color: #888; font-size: 0.9rem;">åé›†ã—ãŸè¨¼æ‹ ã‹ã‚‰ã€æœ€ã‚‚ç–‘ã‚ã—ã„äººç‰©ã‚’é¸ã¹</div>
    </div>

    <!-- çµæœç”»é¢ -->
    <div class="result-screen" id="resultScreen">
        <!-- å‹•çš„ã«å†…å®¹ã‚’ç”Ÿæˆ -->
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
        let gameState = {
            phase: 'title', // title, scenario, game, deduction, result
            currentScenario: null,
            evidence: [],
            suspects: [],
            trueCriminal: null,
            stream: null,
            model: null,
            isModelLoaded: false,
            soundEnabled: true,
            bgmPlaying: false,
            score: 0,
            maxScore: 0
        };
        
        // éŸ³éŸ¿åŠ¹æœç®¡ç†
        const audioManager = {
            bgm: null,
            evidenceSound: null,
            scanSound: null,
            successSound: null,
            failSound: null,
            
            init() {
                this.bgm = document.getElementById('bgm');
                this.evidenceSound = document.getElementById('evidenceSound');
                this.scanSound = document.getElementById('scanSound');
                this.successSound = document.getElementById('successSound');
                this.failSound = document.getElementById('failSound');
                
                // éŸ³é‡è¨­å®š
                this.bgm.volume = 0.3;
                this.evidenceSound.volume = 0.6;
                this.scanSound.volume = 0.5;
                this.successSound.volume = 0.7;
                this.failSound.volume = 0.7;
            },
            
            playBGM() {
                if (!gameState.soundEnabled || gameState.bgmPlaying) return;
                try {
                    this.bgm.currentTime = 0;
                    this.bgm.play();
                    gameState.bgmPlaying = true;
                } catch (e) {
                    console.log('BGMå†ç”Ÿã‚¨ãƒ©ãƒ¼:', e);
                }
            },
            
            stopBGM() {
                if (this.bgm) {
                    this.bgm.pause();
                    this.bgm.currentTime = 0;
                    gameState.bgmPlaying = false;
                }
            },
            
            playSound(soundName) {
                if (!gameState.soundEnabled) return;
                try {
                    const sound = this[soundName];
                    if (sound) {
                        sound.currentTime = 0;
                        sound.play();
                    }
                } catch (e) {
                    console.log(`${soundName}å†ç”Ÿã‚¨ãƒ©ãƒ¼:`, e);
                }
            },
            
            toggleMute() {
                gameState.soundEnabled = !gameState.soundEnabled;
                if (!gameState.soundEnabled) {
                    this.stopBGM();
                }
                this.updateVolumeButton();
            },
            
            updateVolumeButton() {
                const btns = [document.getElementById('volumeBtn'), document.getElementById('volumeBtn2')];
                btns.forEach(btn => {
                    if (btn) {
                        btn.textContent = gameState.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
                        btn.classList.toggle('muted', !gameState.soundEnabled);
                    }
                });
            }
        };

        // äº‹ä»¶ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        const scenarios = {
            study: {
                id: 'study',
                name: 'æ›¸æ–ã®å¯†å®¤äº‹ä»¶',
                description: 'åå®¶ã®æ›¸æ–ã§ç™ºè¦‹ã•ã‚ŒãŸå¯†å®¤æ®ºäººäº‹ä»¶ã€‚è¢«å®³è€…ã¯èª­æ›¸ä¸­ã«ä½•è€…ã‹ã«è¥²ã‚ã‚ŒãŸã€‚',
                background: 'æ·±å¤œã€é›·é›¨ã®ä¸­ã§èµ·ããŸæƒ¨åŠ‡...\næ–½éŒ ã•ã‚ŒãŸæ›¸æ–ã§ç™ºè¦‹ã•ã‚ŒãŸè¢«å®³è€…\nçŠ¯äººã¯ã©ã†ã‚„ã£ã¦å¯†å®¤ã‚’ä½œã£ãŸã®ã‹ï¼Ÿ',
                icon: 'ğŸ“š',
                targetEvidence: ['book', 'laptop', 'chair', 'clock', 'scissors'],
                specialEvidence: {
                    'book': 'decisive', // æ±ºå®šçš„è¨¼æ‹ 
                    'laptop': 'circumstantial', // çŠ¶æ³è¨¼æ‹ 
                    'chair': 'supporting', // è£œåŠ©è¨¼æ‹ 
                    'clock': 'decisive',
                    'scissors': 'circumstantial'
                },
                criminalProfile: {
                    primaryType: 'ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼',
                    motive: 'éºç”£ç›¸ç¶šã‚’å·¡ã‚‹é‡‘éŠ­çš„å‹•æ©Ÿ',
                    method: 'å¯†å®¤ãƒˆãƒªãƒƒã‚¯ã‚’ä½¿ã£ãŸè¨ˆç”»çš„çŠ¯è¡Œ'
                }
            },
            kitchen: {
                id: 'kitchen',
                name: 'ã‚­ãƒƒãƒãƒ³æ¯’æ®ºäº‹ä»¶',
                description: 'é«˜ç´šãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®ã‚­ãƒƒãƒãƒ³ã§èµ·ããŸæ¯’æ®ºäº‹ä»¶ã€‚è¢«å®³è€…ã¯æ–™ç†ä¸­ã«å€’ã‚ŒãŸã€‚',
                background: 'é¦™ã‚Šé«˜ã„æ–™ç†ã®åŒ‚ã„ã®ä¸­ã«æ½œã‚€æ­»ã®ç½ ...\næœ€å¾Œã®æ–™ç†ã«æ··å…¥ã•ã‚ŒãŸæ¯’\nèª°ãŒã€ãªãœã€ã©ã®ã‚ˆã†ã«ï¼Ÿ',
                icon: 'ğŸ³',
                targetEvidence: ['knife', 'cutting board', 'pot', 'pan', 'coffee maker', 'toaster', 'blender', 'refrigerator', 'salt', 'pepper', 'olive oil', 'apple', 'banana', 'milk', 'wine', 'coffee', 'bread', 'chocolate'],
                specialEvidence: {
                    'knife': 'decisive',
                    'cutting board': 'circumstantial',
                    'pot': 'supporting',
                    'pan': 'circumstantial',
                    'coffee maker': 'decisive',
                    'toaster': 'supporting',
                    'blender': 'circumstantial',
                    'refrigerator': 'supporting',
                    'salt': 'decisive',
                    'pepper': 'circumstantial',
                    'olive oil': 'supporting',
                    'apple': 'circumstantial',
                    'banana': 'supporting',
                    'milk': 'decisive',
                    'wine': 'decisive',
                    'coffee': 'circumstantial',
                    'bread': 'supporting',
                    'chocolate': 'false' // å½è¨¼æ‹ 
                },
                criminalProfile: {
                    primaryType: 'å…ƒæ‹äºº',
                    motive: 'æ„›æ†ã«ã‚ˆã‚‹æ„Ÿæƒ…çš„çŠ¯è¡Œ',
                    method: 'æ¯’ç‰©ã‚’ä½¿ã£ãŸè¨ˆç”»çš„æ®ºäºº'
                }
            },
            living: {
                id: 'living',
                name: 'ãƒªãƒ“ãƒ³ã‚°æ’²æ®ºäº‹ä»¶',
                description: 'å®¶æ—å›£ã‚‰ã‚“ã®ãƒªãƒ“ãƒ³ã‚°ã§èµ·ããŸæ’²æ®ºäº‹ä»¶ã€‚è¢«å®³è€…ã¯ä½•è€…ã‹ã«è¥²ã‚ã‚ŒãŸã€‚',
                background: 'å¹³å’Œãªå®¶åº­ã«çªç„¶è¨ªã‚ŒãŸæ‚²åŠ‡...\næ•£ä¹±ã—ãŸãƒªãƒ“ãƒ³ã‚°ã®å®¶å…·\næ¿€æƒ…çš„ãªçŠ¯è¡Œã®ç—•è·¡',
                icon: 'ğŸ ',
                targetEvidence: ['vase', 'remote', 'couch', 'tv', 'potted plant'],
                specialEvidence: {
                    'vase': 'decisive',
                    'remote': 'supporting',
                    'couch': 'circumstantial',
                    'tv': 'circumstantial',
                    'potted plant': 'false'
                },
                criminalProfile: {
                    primaryType: 'å®¶æ—',
                    motive: 'å®¶åº­å†…ã®è¤‡é›‘ãªå•é¡Œ',
                    method: 'è¡å‹•çš„ãªæ’²æ®º'
                }
            }
        };

        // è¨¼æ‹ ãƒ’ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆå¤§å¹…æ‹¡å¼µç‰ˆï¼‰
        const evidenceHints = {
            // èª¿ç†å®¶é›»
            'microwave': [
                'æ‰‰ãŒé–‹ã„ã¦ã„ã‚‹...æ€¥ã„ã§é€ƒã’ãŸè¨¼æ‹ ',
                'ä¸­ã«ä¸å¯©ãªç‰©ä½“...è¨¼æ‹ éš æ»…ï¼Ÿ',
                'æ™‚é–“è¨­å®šãŒç•°å¸¸...ã‚¿ã‚¤ãƒãƒ¼çŠ¯è¡Œ',
                'è¡€ç—•ãŒä»˜ç€...äº‰ã„ã®ç¾å ´'
            ],
            'refrigerator': [
                'æ‰‰ãŒé–‹ã„ãŸã¾ã¾...æ€¥ãªå‡ºæ¥äº‹',
                'ä¸­èº«ãŒæ•£ä¹±...ä½•ã‹ã‚’æ¢ã—ã¦ã„ãŸ',
                'æŒ‡ç´‹ãŒå¤§é‡ã«...é »ç¹ã«ä½¿ç”¨',
                'é›»æºãŒåˆ‡ã‚Œã¦ã„ã‚‹...è¨ˆç”»çš„è¡Œç‚º'
            ],
            'toaster': [
                'ç„¦ã’ãŸåŒ‚ã„ãŒ...é•·æ™‚é–“æ”¾ç½®',
                'ãƒ‘ãƒ³ããšã«è¡€ç—•...äº‰ã„ã®è¨¼æ‹ ',
                'é›»æºã‚³ãƒ¼ãƒ‰ãŒæŠœã‹ã‚Œã¦ã„ã‚‹...è¨¼æ‹ éš æ»…',
                'è¨­å®šãŒæœ€å¤§ã«...ç•°å¸¸ãªä½¿ç”¨'
            ],
            'blender': [
                'ä¸­èº«ãŒèµ¤ã„...è¡€æ¶²ã®å¯èƒ½æ€§',
                'åˆƒãŒæ¬ ã‘ã¦ã„ã‚‹...ç¡¬ã„ç‰©ã‚’å‡¦ç†',
                'è“‹ãŒå‰²ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„ä½¿ç”¨',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººã®ç—•è·¡'
            ],
            'coffee maker': [
                'ã¾ã æ¸©ã‹ã„...çŠ¯äººã¯è¿‘ãã«ã„ã‚‹',
                'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«ç•°ç‰©...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æ°´ã‚¿ãƒ³ã‚¯ãŒç©º...é•·æ™‚é–“æ”¾ç½®',
                'é›»æºãŒå…¥ã£ãŸã¾ã¾...æ€¥ã„ã§é€ƒèµ°'
            ],
            
            // åŠ ç†±ãƒ»èª¿ç†å™¨å…·
            'oven': [
                'ä¸­ã«ä¸å¯©ãªç‰©ä½“...è¨¼æ‹ éš æ»…ï¼Ÿ',
                'ç•°å¸¸ãªé«˜æ¸©è¨­å®š...æ„å›³çš„ãªç ´å£Š',
                'æ‰‰ã«è¡€ç—•...äº‰ã„ã®ç¾å ´',
                'ã‚¿ã‚¤ãƒãƒ¼ãŒä½œå‹•ä¸­...è¨ˆç”»çš„çŠ¯è¡Œ'
            ],
            'stove': [
                'ç«ãŒç‚¹ã‘ã£ã±ãªã—...æ€¥ã„ã§é€ƒã’ãŸ',
                'ã‚³ãƒ³ãƒ­ã«è¡€ç—•...äº‰ã„ã®è¨¼æ‹ ',
                'ã‚¬ã‚¹è‡­ãŒ...ã‚¬ã‚¹æ¼ã‚Œäº‹æ•…ï¼Ÿ',
                'èª¿ç†å™¨å…·ãŒæ•£ä¹±...æ¿€ã—ã„äº‰ã„'
            ],
            'pan': [
                'åº•ã«è¡€ç—•...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨',
                'å–ã£æ‰‹ãŒæ›²ãŒã£ã¦ã„ã‚‹...ç•°å¸¸ãªåŠ›',
                'æ²¹ãŒé£›ã³æ•£ã£ã¦ã„ã‚‹...äº‰ã„ã®æœ€ä¸­',
                'æŒã¡æ‰‹ã«æŒ‡ç´‹...çŠ¯äººã®ç—•è·¡'
            ],
            'pot': [
                'ä¸­èº«ãŒæ²¸é¨°ä¸­...ã‚¿ã‚¤ãƒãƒ¼çŠ¯è¡Œ',
                'å–ã£æ‰‹ãŒå¤–ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ',
                'åº•ãŒç„¦ã’ã¦ã„ã‚‹...é•·æ™‚é–“æ”¾ç½®',
                'è“‹ã«è¡€ç—•...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨'
            ],
            'steamer': [
                'è’¸æ°—ãŒå‡ºç¶šã‘ã¦ã„ã‚‹...æ”¾ç½®ã•ã‚ŒãŸ',
                'ä¸­ã«ç•°ç‰©...è¨¼æ‹ éš æ»…',
                'æ°´ãŒè¡€ã§æ¿ã£ã¦ã„ã‚‹...æ´—æµ„ç—•è·¡',
                'éƒ¨å“ãŒæ•£ä¹±...ç ´å£Šã•ã‚ŒãŸ'
            ],
            
            // ã‚­ãƒƒãƒãƒ³ãƒ„ãƒ¼ãƒ«
            'knife': [
                'è¡€ãŒä»˜ã„ã¦ã„ã‚‹...å‡¶å™¨ã®å¯èƒ½æ€§',
                'ã‚­ãƒƒãƒãƒ³ãƒŠã‚¤ãƒ•ã ...è¡å‹•çš„çŠ¯è¡Œã‹',
                'åˆƒã“ã¼ã‚Œã—ã¦ã„ã‚‹...ç›¸å½“ä½¿ã„è¾¼ã¾ã‚ŒãŸ',
                'æŒ‡ç´‹ãŒãªã„...æ‰‹è¢‹ã‚’ã—ã¦ã„ãŸï¼Ÿ'
            ],
            'cutting board': [
                'è¡€ç—•ãŒæŸ“ã¿ä»˜ã„ã¦ã„ã‚‹...å‡¦ç†ç¾å ´',
                'æ·±ã„åˆ‡ã‚Šå‚·...æ¿€ã—ã„ä½¿ç”¨ç—•',
                'ä½ç½®ãŒä¸è‡ªç„¶...æ€¥ã„ã§ç§»å‹•',
                'æ´—æµ„è·¡ãŒã‚ã‚‹...è¨¼æ‹ éš æ»…'
            ],
            'ladle': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®éš›ã«ä½¿ç”¨',
                'æŒã¡æ‰‹ã«æŒ‡ç´‹...çŠ¯äººã®ç—•è·¡',
                'æ›²ãŒã£ã¦ã„ã‚‹...ç•°å¸¸ãªåŠ›',
                'ä¸­èº«ãŒæ®‹ã£ã¦ã„ã‚‹...æœ€å¾Œã®é£Ÿäº‹'
            ],
            'tongs': [
                'è¡€ã§æ±šã‚Œã¦ã„ã‚‹...äº‰ã„ã®ç—•è·¡',
                'æ¡ã‚Šéƒ¨åˆ†ã«æŒ‡ç´‹...çŠ¯äººç‰¹å®šã®éµ',
                'å…ˆç«¯ãŒæ¬ ã‘ã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ',
                'ç•°å¸¸ãªä½ç½®...æŠ•ã’ã‚‰ã‚ŒãŸï¼Ÿ'
            ],
            'measuring spoon': [
                'ç²‰æœ«ãŒæ®‹ã£ã¦ã„ã‚‹...æ¯’ç‰©ï¼Ÿ',
                'æŒã¡æ‰‹ã«è¡€ç—•...äº‰ã„ã®è¨¼æ‹ ',
                'æ›²ãŒã£ã¦ã„ã‚‹...ç•°å¸¸ãªä½¿ç”¨',
                'ã‚»ãƒƒãƒˆãŒä¸å®Œå…¨...éš ã•ã‚ŒãŸï¼Ÿ'
            ],
            'whisk': [
                'è¡€ãŒçµ¡ã‚“ã§ã„ã‚‹...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨',
                'é‡é‡‘ãŒæ›²ãŒã£ã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ',
                'æŒã¡æ‰‹ã«æŒ‡ç´‹...çŠ¯äººã®ç—•è·¡',
                'ç•°å¸¸ãªæ±šã‚Œ...æ¯’ç‰©æ··å…¥ï¼Ÿ'
            ],
            'peeler': [
                'åˆƒã«è¡€ç—•...å°ã•ãªå‡¶å™¨',
                'æŒã¡æ‰‹ãŒæ»‘ã‚Šã‚„ã™ã„...äº‹æ•…ï¼Ÿ',
                'çš®ããšã«è¡€ãŒ...å‡¦ç†ç¾å ´',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š'
            ],
            'grater': [
                'è¡€ãŒä»˜ç€...å±é™ºãªå‡¶å™¨',
                'å‰Šã‚Šã‹ã™ã«è¡€ãŒ...å‡¦ç†ç—•è·¡',
                'æŒã¡æ‰‹ã«æŒ‡ç´‹...çŠ¯äººã®è¨¼æ‹ ',
                'æ¬ ã‘ã¦ã„ã‚‹...æ¿€ã—ã„ä½¿ç”¨'
            ],
            
            // é£Ÿå™¨ãƒ»ã‚«ãƒˆãƒ©ãƒªãƒ¼
            'plate': [
                'å‰²ã‚Œã¦ã„ã‚‹...æŠ•ã’ã‚‰ã‚ŒãŸè·¡',
                'é£Ÿã¹ã‹ã‘ã®æ–™ç†...æ€¥ãªå‡ºæ¥äº‹',
                'è¡€ç—•ãŒä»˜ç€...äº‰ã„ã®ç¾å ´',
                'é«˜ç´šãªé™¶å™¨...é‡‘éŠ­çš„å‹•æ©Ÿ'
            ],
            'bowl': [
                'å‰²ã‚Œã¦ã„ã‚‹...æŠ•ã’ã‚‰ã‚ŒãŸè·¡',
                'ä¸­èº«ãŒæ®‹ã£ã¦ã„ã‚‹...æ€¥ã„ã§é€ƒèµ°',
                'é«˜ä¾¡ãªé™¶å™¨...é‡‘éŠ­çš„å‹•æ©Ÿï¼Ÿ',
                'åº•ã«è¡€ç—•...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨'
            ],
            'cup': [
                'å£ç´…ã®è·¡ãŒæ®‹ã£ã¦ã„ã‚‹...å¥³æ€§ã®å¯èƒ½æ€§ãŒé«˜ã„',
                'ã¾ã ã‚³ãƒ¼ãƒ’ãƒ¼ãŒæ¸©ã‹ã„...çŠ¯äººã¯é ãã¸è¡Œã£ã¦ã„ãªã„',
                'æŒ‡ç´‹ãŒãã‚Œã„ã«æ‹­ãå–ã‚‰ã‚Œã¦ã„ã‚‹...è¨ˆç”»çš„çŠ¯è¡Œã‹',
                'å–ã£æ‰‹ãŒå£Šã‚Œã¦ã„ã‚‹...äº‰ã„ãŒã‚ã£ãŸè¨¼æ‹ '
            ],
            'wine glass': [
                'å£ç´…ã®è·¡...å¥³æ€§ã®çŠ¯äººï¼Ÿ',
                'å‰²ã‚Œã¦ã„ã‚‹...äº‰ã„ã®è¨¼æ‹ ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...èº«å…ƒç‰¹å®šå¯èƒ½',
                'æ¯’ãŒæ··å…¥...è¨ˆç”»çš„æ®ºäºº'
            ],
            'chopsticks': [
                'è¡€ãŒä»˜ç€...å°ã•ãªå‡¶å™¨',
                'æŠ˜ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„äº‰ã„',
                'æŒã¡æ–¹ã®è·¡...çŠ¯äººã®ç‰¹å¾´',
                'ç•°å¸¸ãªä½ç½®...æŠ•ã’ã‚‰ã‚ŒãŸ'
            ],
            'fork': [
                'æ›²ãŒã£ã¦ã„ã‚‹...åŠ›ãŒåŠ ã‚ã£ãŸè¨¼æ‹ ',
                'è¡€ç—•ãŒä»˜ç€...äº‰ã„ã®éš›ã«ä½¿ç”¨',
                'é«˜ç´šãªéŠ€è£½å“...é‡‘æŒã¡ã®å®¶',
                'æ­¯ãŒæ¬ ã‘ã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ'
            ],
            'spoon': [
                'è¡€ãŒä»˜ã„ã¦ã„ã‚‹...å‡¶å™¨ã®å¯èƒ½æ€§',
                'æŒã¡æ‰‹ã«æŒ‡ç´‹...çŠ¯äººã®ç—•è·¡',
                'æ›²ãŒã£ã¦ã„ã‚‹...ç•°å¸¸ãªåŠ›',
                'æ¯’ã®ç—•è·¡ãŒ...è¨ˆç”»çš„çŠ¯è¡Œï¼Ÿ'
            ],
            
            // ä¿å­˜ãƒ»ãƒ©ãƒƒãƒ”ãƒ³ã‚°ç”¨å“
            'tupperware': [
                'ä¸­èº«ãŒè…ã£ã¦ã„ã‚‹...é•·æœŸé–“æ”¾ç½®',
                'è“‹ãŒå‰²ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ',
                'è¡€ãŒä»˜ç€...è¨¼æ‹ éš æ»…ã«ä½¿ç”¨',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººã®ç—•è·¡'
            ],
            'plastic bag': [
                'è¡€ãŒä»˜ç€...è¨¼æ‹ éš æ»…ã«ä½¿ç”¨',
                'ä¸­ã«ç•°ç‰©...é‡è¦ãªè¨¼æ‹ ',
                'ç ´ã‚Œã¦ã„ã‚‹...æ€¥ã„ã§ä½¿ç”¨',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººç‰¹å®š'
            ],
            'aluminum foil': [
                'è¡€ã§æ±šã‚Œã¦ã„ã‚‹...åŒ…è£…ã«ä½¿ç”¨',
                'ä¸è‡ªç„¶ãªå½¢...ä½•ã‹ã‚’éš ã—ãŸ',
                'æŒ‡ç´‹ã®è·¡...çŠ¯äººã®è¨¼æ‹ ',
                'åˆ‡ã‚Šå£ãŒç²—ã„...æ€¥ã„ã§ä½¿ç”¨'
            ],
            'food wrap': [
                'è¡€ãŒä»˜ç€...è¨¼æ‹ éš æ»…',
                'ä¸è‡ªç„¶ãªä½¿ç”¨è·¡...ä½•ã‹ã‚’åŒ…ã‚“ã ',
                'åˆ‡ã‚Œç«¯ãŒæ•£ä¹±...æ€¥ã„ã§ä½¿ç”¨',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººç‰¹å®š'
            ],
            
            // æ¸…æƒãƒ»è¡›ç”Ÿç”¨å“
            'detergent': [
                'è¡€ãŒè–„ã¾ã£ã¦ã„ã‚‹...è¨¼æ‹ éš æ»…',
                'å¤§é‡ã«ä½¿ç”¨...ç—•è·¡ã‚’æ¶ˆãã†ã¨',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®è¨¼æ‹ ',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ'
            ],
            'sponge': [
                'è¡€ã§èµ¤ãæŸ“ã¾ã£ã¦ã„ã‚‹...æ¸…æƒç—•è·¡',
                'ç•°å¸¸ã«æ±šã‚Œã¦ã„ã‚‹...è¨¼æ‹ éš æ»…',
                'å½¢ãŒå´©ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„ä½¿ç”¨',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººç‰¹å®š'
            ],
            'spray bottle': [
                'è¡€ãŒä»˜ç€...æ¸…æƒã«ä½¿ç”¨',
                'ä¸­èº«ãŒä¸æ˜...æ¯’ç‰©ï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººã®è¨¼æ‹ ',
                'ç•°å¸¸ãªåŒ‚ã„...åŒ–å­¦è–¬å“'
            ],
            'garbage bag': [
                'è¡€ãŒä»˜ç€...è¨¼æ‹ éš æ»…',
                'ä¸è‡ªç„¶ã«é‡ã„...ä½•ã‹ã‚’éš ã—ãŸ',
                'ç ´ã‚Œã¦ã„ã‚‹...æ€¥ã„ã§ä½¿ç”¨',
                'ç•°å¸¸ãªåŒ‚ã„...è…æ•—ç‰©'
            ],
            
            // èª¿å‘³æ–™ãƒ»ã‚¹ãƒ‘ã‚¤ã‚¹
            'salt': [
                'è¡€ãŒæ··ã˜ã£ã¦ã„ã‚‹...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ã«ä½¿ç”¨...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®ç—•è·¡',
                'å®¹å™¨ãŒå‰²ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ'
            ],
            'sugar': [
                'è¡€ã§æ±šã‚Œã¦ã„ã‚‹...äº‰ã„ã®ç¾å ´',
                'ç•°å¸¸ãªè‰²...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š',
                'æ•£ä¹±ã—ã¦ã„ã‚‹...æ¿€ã—ã„äº‰ã„'
            ],
            'soy sauce': [
                'è¡€ãŒæ··ã˜ã£ã¦ã„ã‚‹...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®ç—•è·¡',
                'å®¹å™¨ãŒå‰²ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ'
            ],
            'olive oil': [
                'è¡€ãŒæµ®ã„ã¦ã„ã‚‹...äº‰ã„ã®ç¾å ´',
                'ç•°å¸¸ãªè‰²...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š',
                'åºŠã«æ•£ä¹±...æ¿€ã—ã„äº‰ã„'
            ],
            'pepper': [
                'è¡€ãŒæ··ã˜ã£ã¦ã„ã‚‹...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ã«ä½¿ç”¨...ç›®ãã‚‰ã¾ã—ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®ç—•è·¡',
                'å®¹å™¨ãŒç©º...å¤§é‡ä½¿ç”¨'
            ],
            
            // ç”Ÿé®®é£Ÿå“
            'apple': [
                'é½§ã‚Šè·¡ãŒã‚ã‚‹...çŠ¯äººã®æ­¯å½¢',
                'å¤‰è‰²ã—ã¦ã„ã‚‹...æ¯’ç‰©æ³¨å…¥ï¼Ÿ',
                'è¡€ãŒä»˜ç€...äº‰ã„ã®ç¾å ´',
                'ç•°å¸¸ãªåŒ‚ã„...è…æ•—é€²è¡Œ'
            ],
            'banana': [
                'çš®ãŒæ•£ä¹±...æ€¥ã„ã§é£Ÿã¹ãŸ',
                'å¤‰è‰²ã—ã¦ã„ã‚‹...é•·æ™‚é–“æ”¾ç½®',
                'è¡€ãŒä»˜ç€...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ'
            ],
            'orange': [
                'çš®ãŒå‰¥ã‹ã‚Œã¦ã„ã‚‹...æ™‚é–“ãŒã‚ã£ãŸ',
                'æœæ±ã«è¡€ãŒ...äº‰ã„ã®ç¾å ´',
                'ç•°å¸¸ãªè‰²...æ¯’ç‰©æ³¨å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººç‰¹å®š'
            ],
            'carrot': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ã«åˆ‡ã‚‰ã‚Œã¦ã„ã‚‹...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨ï¼Ÿ',
                'å¤‰è‰²ã—ã¦ã„ã‚‹...æ¯’ç‰©å‡¦ç†',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®ç—•è·¡'
            ],
            'onion': [
                'æ¶™ã®è·¡...çŠ¯äººã®æ„Ÿæƒ…',
                'è¡€ãŒä»˜ç€...äº‰ã„ã®ç¾å ´',
                'ç•°å¸¸ã«åˆ‡ã‚‰ã‚Œã¦ã„ã‚‹...æ€¥ã„ã§å‡¦ç†',
                'åŒ‚ã„ãŒç•°å¸¸...æ¯’ç‰©æ··å…¥ï¼Ÿ'
            ],
            'potato': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ã«åˆ‡ã‚‰ã‚Œã¦ã„ã‚‹...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨ï¼Ÿ',
                'å¤‰è‰²ã—ã¦ã„ã‚‹...æ¯’ç‰©å‡¦ç†',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººç‰¹å®š'
            ],
            'tomato': [
                'æ½°ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ',
                'ç¨®ãŒæ•£ä¹±...äº‰ã„ã®æ¿€ã—ã•',
                'è¡€ã¨ã®åˆ¤åˆ¥å›°é›£...ã‚«ãƒ¢ãƒ•ãƒ©ãƒ¼ã‚¸ãƒ¥',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ'
            ],
            
            // é£²æ–™ãƒ»ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«
            'beer': [
                'ç¼¶ãŒæ½°ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„äº‰ã„',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š',
                'ä¸­èº«ãŒæ®‹ã£ã¦ã„ã‚‹...æ€¥ãªå‡ºæ¥äº‹',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ'
            ],
            'wine': [
                'ãƒœãƒˆãƒ«ãŒå‰²ã‚Œã¦ã„ã‚‹...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨',
                'é«˜ç´šãƒ¯ã‚¤ãƒ³...é‡‘éŠ­çš„å‹•æ©Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®è¨¼æ‹ ',
                'ç•°å¸¸ãªè‰²...æ¯’ç‰©æ··å…¥ï¼Ÿ'
            ],
            'juice': [
                'è¡€ãŒæ··ã˜ã£ã¦ã„ã‚‹...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ãªè‰²...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š',
                'å®¹å™¨ãŒå‰²ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ'
            ],
            'coffee': [
                'ã¾ã æ¸©ã‹ã„...çŠ¯äººã¯è¿‘ãã«ã„ã‚‹',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®ç—•è·¡',
                'é£›ã³æ•£ã£ã¦ã„ã‚‹...äº‰ã„ã®è¨¼æ‹ '
            ],
            'tea': [
                'ç•°å¸¸ãªè‰²...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š',
                'æ¸©åº¦ãŒç•°å¸¸...è¨ˆç”»çš„çŠ¯è¡Œ',
                'èŒ¶è‘‰ãŒæ•£ä¹±...æ¿€ã—ã„äº‰ã„'
            ],
            'milk': [
                'è¡€ãŒæ··ã˜ã£ã¦ã„ã‚‹...äº‰ã„ã®ç¾å ´',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®è¨¼æ‹ ',
                'å®¹å™¨ãŒå‰²ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ'
            ],
            
            // åŠ å·¥ãƒ»ä¿å­˜é£Ÿå“
            'canned food': [
                'ç¼¶ãŒå‡¹ã‚“ã§ã„ã‚‹...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨',
                'ä¸­èº«ãŒç•°å¸¸...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š',
                'é–‹å°è·¡ãŒé›‘...æ€¥ã„ã§ä½¿ç”¨'
            ],
            'instant noodles': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®ç—•è·¡',
                'åŒ…è£…ãŒç ´ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„äº‰ã„'
            ],
            'bread': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®ç¾å ´',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººç‰¹å®š',
                'ä¸è‡ªç„¶ã«åˆ‡ã‚‰ã‚Œã¦ã„ã‚‹...æ€¥ã„ã§å‡¦ç†'
            ],
            
            // è“å­ãƒ»ã‚¹ãƒŠãƒƒã‚¯
            'chocolate': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š',
                'åŒ…è£…ãŒç ´ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„äº‰ã„'
            ],
            'cookies': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®ç¾å ´',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒæ®‹ã£ã¦ã„ã‚‹...çŠ¯äººã®ç—•è·¡',
                'åŒ…è£…ãŒé›‘ã«é–‹ã‘ã‚‰ã‚Œã¦ã„ã‚‹...æ€¥ã„ã§é£Ÿã¹ãŸ'
            ],
            'potato chips': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®è¨¼æ‹ ',
                'ç•°å¸¸ãªåŒ‚ã„...æ¯’ç‰©æ··å…¥ï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®š',
                'è¢‹ãŒç ´ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„äº‰ã„'
            ],
            'book': [
                'ãƒšãƒ¼ã‚¸ã«è¡€ç—•ãŒ...æ¿€ã—ã„äº‰ã„ãŒã‚ã£ãŸ',
                'å“²å­¦æ›¸ã ...çŸ¥çš„ãªçŠ¯äººåƒãŒæµ®ã‹ã¶',
                'ã—ãŠã‚Šã®ä½ç½®ãŒä¸è‡ªç„¶...ä½•ã‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹',
                'æœ€å¾Œã®ãƒšãƒ¼ã‚¸ãŒç ´ã‚‰ã‚Œã¦ã„ã‚‹...è¨¼æ‹ éš æ»…ï¼Ÿ'
            ],
            'chair': [
                'å€’ã‚Œã¦ã„ã‚‹...ã‚‚ã¿åˆã„ã®è·¡ã ',
                'å‘ããŒä¸è‡ªç„¶...ä½•ã‹ã‚’éš ã—ã¦ã„ã‚‹ï¼Ÿ',
                'åº§é¢ã«é«˜ç´šã‚¹ãƒ¼ãƒ„ã®ç¹Šç¶­...é‡‘æŒã¡ã®çŠ¯è¡Œã‹',
                'è„šãŒæŠ˜ã‚Œã¦ã„ã‚‹...ç›¸å½“ãªåŠ›ãŒåŠ ã‚ã£ãŸ'
            ],
            'cell phone': [
                'ç”»é¢ãŒå‰²ã‚Œã¦ã„ã‚‹...çŠ¯äººãŒè½ã¨ã—ãŸã®ã‹',
                'æœ€å¾Œã®é€šè©±å±¥æ­´...é‡è¦ãªæ‰‹ãŒã‹ã‚Šã ',
                'ä½ç½®ãŒä¸è‡ªç„¶...æŠ•ã’ã‚‰ã‚ŒãŸå¯èƒ½æ€§',
                'ãƒãƒƒãƒ†ãƒªãƒ¼ãŒåˆ‡ã‚Œã¦ã„ã‚‹...é•·æ™‚é–“çµŒéã—ã¦ã„ã‚‹'
            ],
            'knife': [
                'è¡€ãŒä»˜ã„ã¦ã„ã‚‹...å‡¶å™¨ã®å¯èƒ½æ€§',
                'ã‚­ãƒƒãƒãƒ³ãƒŠã‚¤ãƒ•ã ...è¡å‹•çš„çŠ¯è¡Œã‹',
                'åˆƒã“ã¼ã‚Œã—ã¦ã„ã‚‹...ç›¸å½“ä½¿ã„è¾¼ã¾ã‚ŒãŸ',
                'æŒ‡ç´‹ãŒãªã„...æ‰‹è¢‹ã‚’ã—ã¦ã„ãŸï¼Ÿ'
            ],
            'bottle': [
                'ä¸­èº«ãŒç©º...æœ€å¾Œã®æ™©é¤ã‹',
                'ãƒ¯ã‚¤ãƒ³ãƒœãƒˆãƒ«...é«˜ç´šå“ã ',
                'å‰²ã‚Œã¦ã„ã‚‹...å‡¶å™¨ã¨ã—ã¦ä½¿ã‚ã‚ŒãŸï¼Ÿ',
                'ãƒ©ãƒ™ãƒ«ãŒå‰¥ãŒã•ã‚Œã¦ã„ã‚‹...èº«å…ƒã‚’éš ã™ï¼Ÿ'
            ],
            'laptop': [
                'é–‹ã„ãŸã¾ã¾...æ€¥ã„ã§é€ƒã’ãŸï¼Ÿ',
                'ç”»é¢ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸...è„…è¿«ã‹ï¼Ÿ',
                'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã«è¡€ãŒ...äº‰ã„ãªãŒã‚‰æ“ä½œã—ãŸ',
                'ã‚«ãƒ¡ãƒ©ãŒä½œå‹•ä¸­...éŒ²ç”»ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‚'
            ],
            'bag': [
                'ä¸­èº«ãŒæ•£ä¹±...ä½•ã‹ã‚’æ¢ã—ã¦ã„ãŸ',
                'é«˜ç´šãƒ–ãƒ©ãƒ³ãƒ‰å“...é‡‘æŒã¡ã®æŒã¡ç‰©',
                'åº•ã«éš ã—ãƒã‚±ãƒƒãƒˆ...å¯†è¼¸ã‹ï¼Ÿ',
                'ã‚¹ãƒˆãƒ©ãƒƒãƒ—ãŒåˆ‡ã‚Œã¦ã„ã‚‹...å¼•ã£å¼µã‚‰ã‚ŒãŸ'
            ],
            'person': [
                'ã¾ã èª°ã‹ã„ã‚‹...çŠ¯äººã‹ï¼Ÿç›®æ’ƒè€…ã‹ï¼Ÿ',
                'æ€¯ãˆãŸè¡¨æƒ…...ä½•ã‹ã‚’çŸ¥ã£ã¦ã„ã‚‹',
                'æœè£…ãŒä¹±ã‚Œã¦ã„ã‚‹...äº‰ã„ã«å·»ãè¾¼ã¾ã‚ŒãŸï¼Ÿ',
                'é€ƒã’ã‚ˆã†ã¨ã—ã¦ã„ã‚‹...è¿½ã„è©°ã‚ã‚‰ã‚Œã¦ã„ã‚‹'
            ],
            'clock': [
                'æ™‚è¨ˆãŒæ­¢ã¾ã£ã¦ã„ã‚‹...çŠ¯è¡Œæ™‚åˆ»ã‹',
                'é‡ãŒä¸è‡ªç„¶ãªä½ç½®...ãƒ€ã‚¤ã‚¤ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼Ÿ',
                'å£Šã‚Œã¦ã„ã‚‹...äº‰ã„ã®æœ€ä¸­ã«',
                'ã‚¢ãƒ©ãƒ¼ãƒ ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹...è¨ˆç”»çš„ï¼Ÿ'
            ],
            'tv': [
                'ã¾ã é›»æºãŒå…¥ã£ã¦ã„ã‚‹...æ€¥ãªå‡ºæ¥äº‹',
                'ãƒ‹ãƒ¥ãƒ¼ã‚¹ç•ªçµ„...äº‹ä»¶ã¨é–¢ä¿‚ãŒï¼Ÿ',
                'ç”»é¢ã«æŒ‡ç´‹...æœ€å¾Œã«è§¦ã£ãŸäººç‰©',
                'ãƒªãƒ¢ã‚³ãƒ³ãŒè¦‹å½“ãŸã‚‰ãªã„...æŒã¡å»ã‚‰ã‚ŒãŸï¼Ÿ'
            ],
            'potted plant': [
                'åœŸãŒæ•£ã‚‰ã°ã£ã¦ã„ã‚‹...äº‰ã„ã®è·¡',
                'æ¯ã‚Œã‹ã‘ã¦ã„ã‚‹...é•·æœŸé–“æ”¾ç½®',
                'é‰¢ãŒå‰²ã‚Œã¦ã„ã‚‹...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨ï¼Ÿ',
                'ä¸è‡ªç„¶ãªä½ç½®...ä½•ã‹ã‚’éš ã—ã¦ã„ã‚‹'
            ],
            'scissors': [
                'è¡€ãŒä»˜ç€...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨',
                'åˆƒãŒæ¬ ã‘ã¦ã„ã‚‹...æ¿€ã—ã„ä½¿ç”¨ç—•',
                'ç³¸ããšãŒä»˜ç€...ä½•ã‹ã‚’åˆ‡ã£ãŸï¼Ÿ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...çŠ¯äººç‰¹å®šã®éµ'
            ],
            'fork': [
                'æ›²ãŒã£ã¦ã„ã‚‹...åŠ›ãŒåŠ ã‚ã£ãŸè¨¼æ‹ ',
                'è¡€ç—•ãŒä»˜ç€...äº‰ã„ã®éš›ã«ä½¿ç”¨',
                'é«˜ç´šãªéŠ€è£½å“...é‡‘æŒã¡ã®å®¶',
                'æ­¯ãŒæ¬ ã‘ã¦ã„ã‚‹...æ¿€ã—ã„è¡æ’ƒ'
            ],
            'spoon': [
                'è¡€ãŒä»˜ã„ã¦ã„ã‚‹...å‡¶å™¨ã®å¯èƒ½æ€§',
                'æŒã¡æ‰‹ã«æŒ‡ç´‹...çŠ¯äººã®ç—•è·¡',
                'æ›²ãŒã£ã¦ã„ã‚‹...ç•°å¸¸ãªåŠ›',
                'æ¯’ã®ç—•è·¡ãŒ...è¨ˆç”»çš„çŠ¯è¡Œï¼Ÿ'
            ],
            'bowl': [
                'å‰²ã‚Œã¦ã„ã‚‹...æŠ•ã’ã‚‰ã‚ŒãŸè·¡',
                'ä¸­èº«ãŒæ®‹ã£ã¦ã„ã‚‹...æ€¥ã„ã§é€ƒèµ°',
                'é«˜ä¾¡ãªé™¶å™¨...é‡‘éŠ­çš„å‹•æ©Ÿï¼Ÿ',
                'åº•ã«è¡€ç—•...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨'
            ],
            'wine glass': [
                'å£ç´…ã®è·¡...å¥³æ€§ã®çŠ¯äººï¼Ÿ',
                'å‰²ã‚Œã¦ã„ã‚‹...äº‰ã„ã®è¨¼æ‹ ',
                'æŒ‡ç´‹ãŒãã£ãã‚Š...èº«å…ƒç‰¹å®šå¯èƒ½',
                'æ¯’ãŒæ··å…¥...è¨ˆç”»çš„æ®ºäºº'
            ],
            'mouse': [
                'è¡€ã§æ±šã‚Œã¦ã„ã‚‹...PCã§ä½•ã‹ã‚’æ“ä½œ',
                'ã‚¯ãƒªãƒƒã‚¯ç—•ãŒç•°å¸¸...æ€¥ã„ã§ã„ãŸ',
                'ä½ç½®ãŒãšã‚Œã¦ã„ã‚‹...äº‰ã„ãªãŒã‚‰ä½¿ç”¨',
                'ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹...æŒã¡å»ã‚Šå¯èƒ½'
            ],
            'keyboard': [
                'ã‚­ãƒ¼ãŒè¡€ã¾ã¿ã‚Œ...æœ€å¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼Ÿ',
                'ç‰¹å®šã®ã‚­ãƒ¼ãŒæŠ¼ã—ã£ã±ãªã—...ãƒ€ã‚¤ã‚¤ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
                'é…ç·šãŒåˆ‡ã‚Œã¦ã„ã‚‹...è¨¼æ‹ éš æ»…',
                'æŒ‡ç´‹ãŒå¤§é‡ã«...ä½¿ç”¨é »åº¦ãŒé«˜ã„'
            ],
            'remote': [
                'è¡€ãŒä»˜ç€...äº‰ã„ã®éš›ã«æ¡ã£ã¦ã„ãŸ',
                'ãƒãƒƒãƒ†ãƒªãƒ¼ãŒæŠœã‹ã‚Œã¦ã„ã‚‹...è¨¼æ‹ éš æ»…',
                'ç‰¹å®šã®ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¾ã¾...ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼Ÿ',
                'æŠ•ã’ã¤ã‘ã‚‰ã‚ŒãŸè·¡...æ¿€ã—ã„äº‰ã„'
            ],
            'microwave': [
                'æ‰‰ãŒé–‹ã„ã¦ã„ã‚‹...æ€¥ã„ã§é€ƒã’ãŸè¨¼æ‹ ',
                'ä¸­ã«ä¸å¯©ãªç‰©ä½“...è¨¼æ‹ éš æ»…ï¼Ÿ',
                'æ™‚é–“è¨­å®šãŒç•°å¸¸...ã‚¿ã‚¤ãƒãƒ¼çŠ¯è¡Œ',
                'è¡€ç—•ãŒä»˜ç€...äº‰ã„ã®ç¾å ´'
            ],
            'vase': [
                'å‰²ã‚Œã¦ã„ã‚‹...å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨',
                'èŠ±ãŒæ¯ã‚Œã¦ã„ã‚‹...é•·æ™‚é–“æ”¾ç½®',
                'ä½ç½®ãŒå¤‰ã‚ã£ã¦ã„ã‚‹...çŠ¯äººãŒå‹•ã‹ã—ãŸ',
                'ç ´ç‰‡ã«è¡€ç—•...æ¿€ã—ã„äº‰ã„'
            ],
            'backpack': [
                'ä¸­èº«ãŒæ•£ä¹±...ä½•ã‹ã‚’æ¢ã—ã¦ã„ãŸ',
                'ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼ãŒå£Šã‚Œã¦ã„ã‚‹...æ€¥ã„ã§é–‹ã‘ãŸ',
                'è¡€ãŒä»˜ç€...äº‰ã„ã«å·»ãè¾¼ã¾ã‚ŒãŸ',
                'é‡è¦æ›¸é¡ãŒå…¥ã£ã¦ã„ã‚‹...å‹•æ©Ÿã«é–¢é€£'
            ],
            'handbag': [
                'ã‚¹ãƒˆãƒ©ãƒƒãƒ—ãŒåˆ‡ã‚Œã¦ã„ã‚‹...å¼•ã£å¼µã‚‰ã‚ŒãŸ',
                'è²¡å¸ƒãŒãªã„...å¼·ç›—ã®å¯èƒ½æ€§',
                'é«˜ç´šãƒ–ãƒ©ãƒ³ãƒ‰...æ¨™çš„ã«ã•ã‚ŒãŸç†ç”±',
                'ä¸­ã‹ã‚‰è–¬ãŒ...æ¯’æ®ºè¨ˆç”»ï¼Ÿ'
            ],
            'couch': [
                'ã‚¯ãƒƒã‚·ãƒ§ãƒ³ãŒãšã‚Œã¦ã„ã‚‹...äº‰ã„ã®è·¡',
                'è¡€ç—•ãŒä»˜ç€...çŠ¯è¡Œç¾å ´',
                'éš ã‚ŒãŸç‰©ãŒã‚ã‚‹...è¨¼æ‹ éš ã—',
                'åº§ã‚Šæ–¹ãŒä¸è‡ªç„¶...ææ€–ã®è¡¨ã‚Œ'
            ],
            'bed': [
                'ã‚·ãƒ¼ãƒ„ãŒä¹±ã‚Œã¦ã„ã‚‹...äº‰ã„ãŒã‚ã£ãŸ',
                'è¡€ç—•ãŒå¤§é‡ã«...è‡´å‘½å‚·ã®ç¾å ´',
                'æ•ã®ä½ç½®ãŒç•°å¸¸...çª’æ¯ã®å¯èƒ½æ€§',
                'éš ã—å ´æ‰€ãŒã‚ã‚‹...é‡è¦ãªè¨¼æ‹ '
            ],
            'dining table': [
                'é£Ÿäº‹ãŒæ®‹ã£ã¦ã„ã‚‹...çªç„¶ã®çŠ¯è¡Œ',
                'ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå€’ã‚Œã¦ã„ã‚‹...æ¿€ã—ã„äº‰ã„',
                'è¡€ç—•ãŒé£›ã³æ•£ã£ã¦ã„ã‚‹...ç¾å ´ã¯ã“ã“',
                'é«˜ç´šãªæœ¨æ...é‡‘éŠ­çš„å‹•æ©Ÿ'
            ]
        };

        // çŠ¯äººã‚¿ã‚¤ãƒ—
        const criminalTypes = [
            {
                name: 'å…ƒæ‹äºº',
                description: 'æ„Ÿæƒ…çš„ãªå‹•æ©Ÿã€è¦ªå¯†ãªé–¢ä¿‚ã®ç—•è·¡',
                relatedEvidence: ['cup', 'cell phone', 'book']
            },
            {
                name: 'ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼',
                description: 'é‡‘éŠ­çš„å‹•æ©Ÿã€ä»•äº‹é–¢é€£ã®è¨¼æ‹ ',
                relatedEvidence: ['laptop', 'chair', 'bag']
            },
            {
                name: 'å®¶æ—',
                description: 'è¤‡é›‘ãªæ„Ÿæƒ…ã€æ—¥å¸¸çš„ãªç‰©å“',
                relatedEvidence: ['tv', 'potted plant', 'clock']
            },
            {
                name: 'å¼·ç›—',
                description: 'é‡‘å“ç›®çš„ã€æš´åŠ›çš„ãªç—•è·¡',
                relatedEvidence: ['knife', 'bag', 'chair']
            },
            {
                name: 'ã‚¹ãƒˆãƒ¼ã‚«ãƒ¼',
                description: 'åŸ·ç€å¿ƒã€ç•°å¸¸ãªè¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³',
                relatedEvidence: ['cell phone', 'person', 'book']
            }
        ];

        // ç‰©ä½“åã®æ—¥æœ¬èªãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆå¤§å¹…æ‹¡å¼µç‰ˆï¼‰
        const objectNames = {
            // èª¿ç†å®¶é›»
            'microwave': 'é›»å­ãƒ¬ãƒ³ã‚¸',
            'refrigerator': 'å†·è”µåº«',
            'toaster': 'ãƒˆãƒ¼ã‚¹ã‚¿ãƒ¼',
            'blender': 'ãƒŸã‚­ã‚µãƒ¼',
            'coffee maker': 'ã‚³ãƒ¼ãƒ’ãƒ¼ãƒ¡ãƒ¼ã‚«ãƒ¼',
            'oven': 'ã‚ªãƒ¼ãƒ–ãƒ³',
            'stove': 'ã‚³ãƒ³ãƒ­',
            
            // åŠ ç†±ãƒ»èª¿ç†å™¨å…·
            'pan': 'ãƒ•ãƒ©ã‚¤ãƒ‘ãƒ³',
            'pot': 'é‹',
            'steamer': 'è’¸ã—å™¨',
            
            // ã‚­ãƒƒãƒãƒ³ãƒ„ãƒ¼ãƒ«
            'knife': 'ãƒŠã‚¤ãƒ•',
            'cutting board': 'ã¾ãªæ¿',
            'ladle': 'ãŠç‰',
            'tongs': 'ãƒˆãƒ³ã‚°',
            'measuring spoon': 'è¨ˆé‡ã‚¹ãƒ—ãƒ¼ãƒ³',
            'whisk': 'æ³¡ç«‹ã¦å™¨',
            'peeler': 'ãƒ”ãƒ¼ãƒ©ãƒ¼',
            'grater': 'ãŠã‚ã—å™¨',
            
            // é£Ÿå™¨ãƒ»ã‚«ãƒˆãƒ©ãƒªãƒ¼
            'plate': 'çš¿',
            'bowl': 'ãƒœã‚¦ãƒ«',
            'cup': 'ã‚«ãƒƒãƒ—',
            'wine glass': 'ãƒ¯ã‚¤ãƒ³ã‚°ãƒ©ã‚¹',
            'chopsticks': 'ç®¸',
            'fork': 'ãƒ•ã‚©ãƒ¼ã‚¯',
            'spoon': 'ã‚¹ãƒ—ãƒ¼ãƒ³',
            
            // ä¿å­˜ãƒ»ãƒ©ãƒƒãƒ”ãƒ³ã‚°ç”¨å“
            'tupperware': 'ã‚¿ãƒƒãƒ‘ãƒ¼',
            'plastic bag': 'ãƒ“ãƒ‹ãƒ¼ãƒ«è¢‹',
            'aluminum foil': 'ã‚¢ãƒ«ãƒŸãƒ›ã‚¤ãƒ«',
            'food wrap': 'ãƒ©ãƒƒãƒ—',
            
            // æ¸…æƒãƒ»è¡›ç”Ÿç”¨å“
            'detergent': 'æ´—å‰¤',
            'sponge': 'ã‚¹ãƒãƒ³ã‚¸',
            'spray bottle': 'ã‚¹ãƒ—ãƒ¬ãƒ¼ãƒœãƒˆãƒ«',
            'garbage bag': 'ã‚´ãƒŸè¢‹',
            
            // èª¿å‘³æ–™ãƒ»ã‚¹ãƒ‘ã‚¤ã‚¹
            'salt': 'å¡©',
            'sugar': 'ç ‚ç³–',
            'soy sauce': 'é†¤æ²¹',
            'olive oil': 'ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«',
            'pepper': 'èƒ¡æ¤’',
            
            // ç”Ÿé®®é£Ÿå“
            'apple': 'ã‚Šã‚“ã”',
            'banana': 'ãƒãƒŠãƒŠ',
            'orange': 'ã‚ªãƒ¬ãƒ³ã‚¸',
            'carrot': 'ã«ã‚“ã˜ã‚“',
            'onion': 'ç‰ã­ã',
            'potato': 'ã˜ã‚ƒãŒã„ã‚‚',
            'tomato': 'ãƒˆãƒãƒˆ',
            
            // é£²æ–™ãƒ»ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«
            'beer': 'ãƒ“ãƒ¼ãƒ«',
            'wine': 'ãƒ¯ã‚¤ãƒ³',
            'juice': 'ã‚¸ãƒ¥ãƒ¼ã‚¹',
            'coffee': 'ã‚³ãƒ¼ãƒ’ãƒ¼',
            'tea': 'ç´…èŒ¶',
            'milk': 'ç‰›ä¹³',
            
            // åŠ å·¥ãƒ»ä¿å­˜é£Ÿå“
            'canned food': 'ç¼¶è©°',
            'instant noodles': 'ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆéºº',
            'bread': 'ãƒ‘ãƒ³',
            
            // è“å­ãƒ»ã‚¹ãƒŠãƒƒã‚¯
            'chocolate': 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ',
            'cookies': 'ã‚¯ãƒƒã‚­ãƒ¼',
            'potato chips': 'ãƒãƒ†ãƒˆãƒãƒƒãƒ—ã‚¹',
            
            // æ—¢å­˜ã®ã‚¢ã‚¤ãƒ†ãƒ 
            'book': 'æœ¬',
            'chair': 'æ¤…å­',
            'cell phone': 'ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³',
            'bottle': 'ãƒœãƒˆãƒ«',
            'laptop': 'ãƒãƒ¼ãƒˆPC',
            'backpack': 'ãƒãƒƒã‚°',
            'handbag': 'ãƒãƒƒã‚°',
            'person': 'äººå½±',
            'clock': 'æ™‚è¨ˆ',
            'tv': 'ãƒ†ãƒ¬ãƒ“',
            'potted plant': 'æ¤æœ¨é‰¢',
            'scissors': 'ãƒã‚µãƒŸ',
            'remote': 'ãƒªãƒ¢ã‚³ãƒ³',
            'couch': 'ã‚½ãƒ•ã‚¡',
            'bed': 'ãƒ™ãƒƒãƒ‰',
            'dining table': 'ãƒ†ãƒ¼ãƒ–ãƒ«',
            'vase': 'èŠ±ç“¶',
            'mouse': 'ãƒã‚¦ã‚¹',
            'keyboard': 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰'
        };

        // é«˜ç²¾åº¦AIãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿
        async function loadModel() {
            if (gameState.isModelLoaded) return;
            
            try {
                console.log('é«˜ç²¾åº¦AIãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...');
                
                // æœ€é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ«è¨­å®š
                const modelConfig = {
                    base: 'mobilenet_v2',  // ã‚ˆã‚Šé«˜ç²¾åº¦ãªãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«
                    modelUrl: undefined     // æœ€æ–°ã®é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨
                };
                
                gameState.model = await cocoSsd.load(modelConfig);
                gameState.isModelLoaded = true;
                
                console.log('é«˜ç²¾åº¦AIãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');
                console.log('ãƒ¢ãƒ‡ãƒ«è©³ç´°:', {
                    inputShape: gameState.model.inputs ? gameState.model.inputs[0].shape : 'N/A',
                    classes: 'COCO 80ã‚¯ãƒ©ã‚¹ï¼ˆé«˜ç²¾åº¦ç‰ˆï¼‰'
                });
                
                document.getElementById('loading').classList.remove('active');
            } catch (error) {
                console.error('ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                alert('é«˜ç²¾åº¦AIã‚·ã‚¹ãƒ†ãƒ ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ã‚·ãƒŠãƒªã‚ªé¸æŠç”»é¢è¡¨ç¤º
        function showScenarioSelection() {
            // éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            audioManager.init();
            
            // ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚·ãƒŠãƒªã‚ªé¸æŠç”»é¢ã¸
            document.getElementById('titleScreen').classList.add('fade-out');
            
            setTimeout(() => {
                document.getElementById('titleScreen').style.display = 'none';
                document.getElementById('scenarioScreen').style.display = 'flex';
                
                gameState.phase = 'scenario';
                
                // ã‚·ãƒŠãƒªã‚ªã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
                generateScenarioCards();
                
                // BGMé–‹å§‹
                audioManager.playBGM();
            }, 1000);
        }
        
        // ã‚·ãƒŠãƒªã‚ªã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateScenarioCards() {
            const grid = document.getElementById('scenarioGrid');
            grid.innerHTML = '';
            
            Object.values(scenarios).forEach(scenario => {
                const card = document.createElement('div');
                card.className = 'scenario-card';
                
                // é›£æ˜“åº¦è¨ˆç®—
                const evidenceCount = scenario.targetEvidence.length;
                const difficultyLevel = evidenceCount <= 5 ? 'åˆç´š' : evidenceCount <= 7 ? 'ä¸­ç´š' : 'ä¸Šç´š';
                
                card.innerHTML = `
                    <div class="scenario-icon">${scenario.icon}</div>
                    <div class="scenario-name">${scenario.name}</div>
                    <div class="scenario-description">${scenario.description}</div>
                    <div class="scenario-difficulty">é›£æ˜“åº¦: ${difficultyLevel} (è¨¼æ‹ ${evidenceCount}å€‹)</div>
                `;
                
                card.onclick = () => selectScenario(scenario.id);
                grid.appendChild(card);
            });
        }
        
        // ã‚·ãƒŠãƒªã‚ªé¸æŠ
        function selectScenario(scenarioId) {
            gameState.currentScenario = scenarios[scenarioId];
            gameState.maxScore = calculateMaxScore(gameState.currentScenario);
            
            // ã‚·ãƒŠãƒªã‚ªå°å…¥ç”»é¢è¡¨ç¤º
            showScenarioIntro();
        }
        
        // ã‚·ãƒŠãƒªã‚ªå°å…¥ç”»é¢
        function showScenarioIntro() {
            const scenario = gameState.currentScenario;
            
            // å°å…¥æ–‡ã‚’è¡¨ç¤º
            const introHtml = `
                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100vh; 
                            background: rgba(0,0,0,0.95); display: flex; flex-direction: column; 
                            align-items: center; justify-content: center; z-index: 200; padding: 40px; text-align: center;">
                    <div style="font-size: 2rem; color: #ff0000; margin-bottom: 20px; text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);">
                        ${scenario.icon} ${scenario.name}
                    </div>
                    <div style="font-size: 1.2rem; color: #ddd; line-height: 1.8; max-width: 600px; margin-bottom: 30px;">
                        ${scenario.background.replace(/\n/g, '<br>')}
                    </div>
                    <div style="background: rgba(255, 0, 0, 0.1); border: 1px solid #ff0000; 
                                padding: 15px; border-radius: 10px; margin-bottom: 30px; max-width: 500px;">
                        <strong style="color: #ff6666;">æœæŸ»ç›®æ¨™:</strong><br>
                        è¨¼æ‹ ã‚’${scenario.targetEvidence.length}å€‹ç™ºè¦‹ã—ã€çœŸçŠ¯äººã‚’ç‰¹å®šã›ã‚ˆ
                    </div>
                    <button onclick="startGame()" style="background: #ff0000; color: white; border: none; 
                            padding: 15px 40px; font-size: 1.2rem; border-radius: 50px; cursor: pointer; 
                            transition: all 0.3s ease; box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);">
                        ğŸ” æœæŸ»é–‹å§‹
                    </button>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', introHtml);
        }
        
        // ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹
        function backToTitle() {
            document.getElementById('scenarioScreen').style.display = 'none';
            document.getElementById('titleScreen').style.display = 'block';
            document.getElementById('titleScreen').classList.remove('fade-out');
            
            gameState.phase = 'title';
            audioManager.stopBGM();
        }
        
        // æœ€å¤§ã‚¹ã‚³ã‚¢è¨ˆç®—
        function calculateMaxScore(scenario) {
            let maxScore = 0;
            scenario.targetEvidence.forEach(evidenceType => {
                const quality = scenario.specialEvidence[evidenceType] || 'supporting';
                switch (quality) {
                    case 'decisive': maxScore += 100; break;
                    case 'circumstantial': maxScore += 60; break;
                    case 'supporting': maxScore += 30; break;
                    case 'false': maxScore -= 20; break;
                }
            });
            return maxScore + 200; // æ­£ã—ã„æ¨ç†ãƒœãƒ¼ãƒŠã‚¹
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        async function startGame() {
            console.log('ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†ã‚’å®Ÿè¡Œä¸­...');
            
            // å°å…¥ç”»é¢ã‚’å‰Šé™¤
            const introElement = document.querySelector('[style*="position: absolute"][style*="z-index: 200"]');
            if (introElement) {
                introElement.remove();
                console.log('å°å…¥ç”»é¢ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            }
            
            // ã‚·ãƒŠãƒªã‚ªé¸æŠç”»é¢ã‚’éè¡¨ç¤º
            document.getElementById('scenarioScreen').style.display = 'none';
            
            // éŸ³éŸ¿ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            audioManager.init();
            
            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ
            createParticles(10);
            
            // ã‚²ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤º
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('loading').style.display = 'block';
            document.getElementById('loading').classList.add('active');
            
            gameState.phase = 'game';
            console.log('ã‚²ãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚ºã‚’gameã«è¨­å®š');
            
            // BGMé–‹å§‹
            audioManager.playBGM();
            
            try {
                console.log('ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–ã‚’é–‹å§‹...');
                await initCamera();
                console.log('ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–å®Œäº†');
                
                console.log('AIãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã‚’é–‹å§‹...');
                await loadModel();
                console.log('AIãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');
                
                // ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                setupTapDetection();
                console.log('ã‚¿ãƒƒãƒ—æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’è¨­å®š');
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’éè¡¨ç¤º
                document.getElementById('loading').style.display = 'none';
                document.getElementById('loading').classList.remove('active');
                
                console.log('ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ');
                
            } catch (error) {
                console.error('ã‚²ãƒ¼ãƒ é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                alert(`ã‚²ãƒ¼ãƒ é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
                
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚·ãƒŠãƒªã‚ªé¸æŠã«æˆ»ã‚‹
                document.getElementById('gameScreen').style.display = 'none';
                document.getElementById('scenarioScreen').style.display = 'flex';
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // ã‚¿ãƒƒãƒ—æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        function setupTapDetection() {
            const gameScreen = document.getElementById('gameScreen');
            
            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œï¼‰
            gameScreen.addEventListener('touchstart', handleTap, { passive: false });
            
            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆPCå¯¾å¿œï¼‰
            gameScreen.addEventListener('click', handleTap);
        }
        
        // ã‚¿ãƒƒãƒ—/ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function handleTap(event) {
            event.preventDefault();
            
            if (!gameState.isModelLoaded || gameState.phase !== 'game') return;
            
            // ã‚¿ãƒƒãƒ—åº§æ¨™ã‚’å–å¾—
            let clientX, clientY;
            if (event.type === 'touchstart') {
                const touch = event.touches[0];
                clientX = touch.clientX;
                clientY = touch.clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }
            
            // ç”»é¢åº§æ¨™ã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹åº§æ¨™ã«å¤‰æ›
            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            
            const tapX = (clientX - rect.left) * (canvas.width / rect.width);
            const tapY = (clientY - rect.top) * (canvas.height / rect.height);
            
            console.log(`ã‚¿ãƒƒãƒ—ä½ç½®: (${Math.round(tapX)}, ${Math.round(tapY)})`);
            
            // ã‚¿ãƒƒãƒ—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¡¨ç¤º
            showTapIndicator(clientX, clientY);
            
            // ã‚¿ãƒƒãƒ—ä½ç½®ã§ã®ç‰©ä½“æ¤œçŸ¥ã‚’å®Ÿè¡Œ
            detectObjectAtPosition(tapX, tapY);
        }
        
        // ã‚¿ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º
        function showTapIndicator(x, y) {
            const indicator = document.createElement('div');
            indicator.className = 'tap-indicator';
            indicator.style.left = x + 'px';
            indicator.style.top = y + 'px';
            
            document.getElementById('gameScreen').appendChild(indicator);
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã«å‰Šé™¤
            setTimeout(() => {
                indicator.remove();
            }, 600);
        }

        // ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œç‰ˆï¼‰
        async function initCamera() {
            console.log('ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–é–‹å§‹...');
            
            try {
                // HTTPSç¢ºèª
                if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
                    console.warn('HTTPSã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒåˆ¶é™ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                }
                
                // ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚µãƒãƒ¼ãƒˆç¢ºèª
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeã€Firefoxã€Safariç­‰ã®æœ€æ–°ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã”ä½¿ç”¨ãã ã•ã„ã€‚');
                }
                
                // ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§ã®ç¢ºèª
                try {
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    const videoDevices = devices.filter(device => device.kind === 'videoinput');
                    console.log(`åˆ©ç”¨å¯èƒ½ãªã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹: ${videoDevices.length}å€‹`);
                    
                    if (videoDevices.length === 0) {
                        throw new Error('ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚«ãƒ¡ãƒ©ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                    }
                } catch (enumError) {
                    console.warn('ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', enumError);
                }
                
                // è¤‡æ•°ã®è¨­å®šã§æ®µéšçš„ã«è©¦è¡Œ
                const cameraConfigs = [
                    // è¨­å®š1: åŸºæœ¬è¨­å®š
                    {
                        video: {
                            width: { ideal: 640 },
                            height: { ideal: 480 }
                        }
                    },
                    // è¨­å®š2: ã‚ˆã‚Šåˆ¶é™ã®å°‘ãªã„è¨­å®š
                    {
                        video: true
                    }
                ];
                
                let stream = null;
                let lastError = null;
                
                for (let i = 0; i < cameraConfigs.length; i++) {
                    try {
                        console.log(`ã‚«ãƒ¡ãƒ©è¨­å®š${i + 1}ã‚’è©¦è¡Œä¸­...`);
                        stream = await navigator.mediaDevices.getUserMedia(cameraConfigs[i]);
                        console.log(`ã‚«ãƒ¡ãƒ©è¨­å®š${i + 1}ã§æˆåŠŸ`);
                        break;
                    } catch (configError) {
                        console.log(`ã‚«ãƒ¡ãƒ©è¨­å®š${i + 1}å¤±æ•—:`, configError.message);
                        lastError = configError;
                    }
                }
                
                if (!stream) {
                    throw lastError || new Error('å…¨ã¦ã®ã‚«ãƒ¡ãƒ©è¨­å®šã§å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                gameState.stream = stream;
                
                const video = document.getElementById('video');
                if (!video) {
                    throw new Error('ãƒ“ãƒ‡ã‚ªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                video.srcObject = stream;
                console.log('ãƒ“ãƒ‡ã‚ªè¦ç´ ã«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è¨­å®š');
                
                // ãƒ“ãƒ‡ã‚ªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã¤
                await new Promise((resolve, reject) => {
                    const timeoutId = setTimeout(() => {
                        reject(new Error('ãƒ“ãƒ‡ã‚ªèª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ5ç§’ï¼‰'));
                    }, 5000);
                    
                    video.onloadedmetadata = () => {
                        clearTimeout(timeoutId);
                        console.log(`ãƒ“ãƒ‡ã‚ªã‚µã‚¤ã‚º: ${video.videoWidth}x${video.videoHeight}`);
                        
                        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºè¨­å®š
                        const canvas = document.getElementById('canvas');
                        if (canvas) {
                            canvas.width = video.videoWidth || 640;
                            canvas.height = video.videoHeight || 480;
                            console.log(`ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºè¨­å®š: ${canvas.width}x${canvas.height}`);
                        }
                        
                        resolve();
                    };
                    
                    video.onerror = (error) => {
                        clearTimeout(timeoutId);
                        console.error('ãƒ“ãƒ‡ã‚ªèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                        reject(new Error('ãƒ“ãƒ‡ã‚ªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                    };
                });
                
                // ãƒ“ãƒ‡ã‚ªå†ç”Ÿé–‹å§‹
                try {
                    await video.play();
                    console.log('ãƒ“ãƒ‡ã‚ªå†ç”Ÿé–‹å§‹');
                } catch (playError) {
                    console.warn('è‡ªå‹•å†ç”Ÿå¤±æ•—:', playError.message);
                    // è‡ªå‹•å†ç”Ÿå¤±æ•—ã¯è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„
                }
                
                console.log('ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–å®Œäº†');
                return true;
                
            } catch (error) {
                console.error('ã‚«ãƒ¡ãƒ©åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                
                // ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                if (gameState.stream) {
                    gameState.stream.getTracks().forEach(track => track.stop());
                    gameState.stream = null;
                }
                
                // ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸè©³ç´°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                let errorMessage = 'ã‚«ãƒ¡ãƒ©ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\n';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage += 'ã€åŸå› ã€‘ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ\n\n';
                    errorMessage += 'ã€è§£æ±ºæ–¹æ³•ã€‘\n';
                    errorMessage += '1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼å·¦å´ã®ã‚«ãƒ¡ãƒ©ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯\n';
                    errorMessage += '2. ã€Œã‚«ãƒ¡ãƒ©ã€ã‚’ã€Œè¨±å¯ã€ã«è¨­å®š\n';
                    errorMessage += '3. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'ã€åŸå› ã€‘ã‚«ãƒ¡ãƒ©ãƒ‡ãƒã‚¤ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\n\n';
                    errorMessage += 'ã€è§£æ±ºæ–¹æ³•ã€‘\n';
                    errorMessage += '1. ã‚«ãƒ¡ãƒ©ãŒæ­£ã—ãæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª\n';
                    errorMessage += '2. ä»–ã®ã‚¢ãƒ—ãƒªã§ã‚«ãƒ¡ãƒ©ãŒä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª\n';
                    errorMessage += '3. PCã‚’å†èµ·å‹•ã—ã¦ãŠè©¦ã—ãã ã•ã„';
                } else if (error.name === 'NotReadableError') {
                    errorMessage += 'ã€åŸå› ã€‘ã‚«ãƒ¡ãƒ©ãŒä»–ã®ã‚¢ãƒ—ãƒªã§ä½¿ç”¨ä¸­ã§ã™\n\n';
                    errorMessage += 'ã€è§£æ±ºæ–¹æ³•ã€‘\n';
                    errorMessage += '1. Zoomã€Teamsç­‰ã®ãƒ“ãƒ‡ã‚ªé€šè©±ã‚¢ãƒ—ãƒªã‚’çµ‚äº†\n';
                    errorMessage += '2. ä»–ã®ã‚«ãƒ¡ãƒ©ã‚¢ãƒ—ãƒªã‚’çµ‚äº†\n';
                    errorMessage += '3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èµ·å‹•';
                } else if (error.name === 'OverconstrainedError') {
                    errorMessage += 'ã€åŸå› ã€‘ã‚«ãƒ¡ãƒ©ã®è¨­å®šãŒå¯¾å¿œã—ã¦ã„ã¾ã›ã‚“\n\n';
                    errorMessage += 'ã€è§£æ±ºæ–¹æ³•ã€‘\n';
                    errorMessage += '1. å¤ã„ã‚«ãƒ¡ãƒ©ãƒ‰ãƒ©ã‚¤ãƒã‚’æ›´æ–°\n';
                    errorMessage += '2. åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§è©¦è¡Œ\n';
                    errorMessage += '3. ã‚·ã‚¹ãƒ†ãƒ ã‚’å†èµ·å‹•';
                } else {
                    errorMessage += `ã€è©³ç´°ã‚¨ãƒ©ãƒ¼ã€‘${error.message}\n\n`;
                    errorMessage += 'ã€ä¸€èˆ¬çš„ãªè§£æ±ºæ–¹æ³•ã€‘\n';
                    errorMessage += '1. HTTPSæ¥ç¶šã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª\n';
                    errorMessage += '2. æœ€æ–°ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ç”¨\n';
                    errorMessage += '3. ã‚«ãƒ¡ãƒ©ã®ç‰©ç†çš„æ¥ç¶šã‚’ç¢ºèª';
                }
                
                throw new Error(errorMessage);
            }
        }

        // ã‚¿ãƒƒãƒ—ä½ç½®ã§ã®ç‰©ä½“æ¤œçŸ¥
        async function detectObjectAtPosition(tapX, tapY) {
            if (!gameState.isModelLoaded) {
                alert('AIã‚·ã‚¹ãƒ†ãƒ ãŒã¾ã èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“');
                return;
            }

            if (gameState.evidence.length >= 5) {
                // æ¨ç†ãƒ•ã‚§ãƒ¼ã‚ºã¸
                startDeductionPhase();
                return;
            }

            // ã‚¹ã‚­ãƒ£ãƒ³éŸ³å†ç”Ÿ
            audioManager.playSound('scanSound');

            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            try {
                // é«˜ç²¾åº¦ç‰©ä½“æ¤œå‡ºå®Ÿè¡Œ
                const predictions = await gameState.model.detect(video, 100, 0.1);
                
                console.log(`å…¨ä½“ã§${predictions.length}å€‹ã®ç‰©ä½“ã‚’æ¤œå‡º`);
                
                // ã‚¿ãƒƒãƒ—ä½ç½®ã«æœ€ã‚‚è¿‘ã„ç‰©ä½“ã‚’æ¤œç´¢
                const targetObject = findObjectAtPosition(predictions, tapX, tapY);
                
                if (!targetObject) {
                    showScanEffect('âŒ ç‰©ä½“ãªã—', tapX, tapY);
                    return;
                }
                
                const objectType = targetObject.class;
                const confidence = Math.round(targetObject.score * 100);
                const japaneseName = objectNames[objectType] || objectType;
                
                console.log(`ã‚¿ãƒƒãƒ—ä½ç½®ã®ç‰©ä½“: ${objectType} (ä¿¡é ¼åº¦: ${confidence}%)`);
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // ã‚¿ãƒƒãƒ—ã—ãŸç‰©ä½“ã®ã¿ã‚’å¼·èª¿è¡¨ç¤º
                highlightTappedObject(targetObject, ctx, tapX, tapY);
                
                // 3Dæƒ…å ±ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¡¨ç¤º
                show3DInfoOverlay(targetObject, tapX, tapY, objectType, confidence);
                
                // ä¿¡é ¼åº¦ãƒã‚§ãƒƒã‚¯
                const dynamicThreshold = getDynamicThreshold(objectType);
                if (confidence < dynamicThreshold) {
                    showScanEffect(`ğŸ“Š ${japaneseName}\nä¿¡é ¼åº¦ä¸è¶³: ${confidence}%\n(è¦${Math.round(dynamicThreshold*100)}%+)`, tapX, tapY);
                    return;
                }
                
                // é‡è¤‡ãƒã‚§ãƒƒã‚¯
                const collectedTypes = gameState.evidence.map(e => e.type);
                if (collectedTypes.includes(objectType)) {
                    showScanEffect(`â™»ï¸ ${japaneseName}\næ—¢ã«åé›†æ¸ˆã¿`, tapX, tapY);
                    return;
                }
                
                // è¨¼æ‹ ã¨ã—ã¦æœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯
                if (evidenceHints[objectType]) {
                    console.log(`æ–°ã—ã„è¨¼æ‹ ç™ºè¦‹: ${objectType} (ä¿¡é ¼åº¦: ${confidence}%)`);
                    
                    // è¨¼æ‹ å“è³ªã‚’åˆ¤å®š
                    const evidenceQuality = getEvidenceQuality(objectType);
                    const score = calculateEvidenceScore(evidenceQuality, confidence);
                    
                    addEvidence(objectType, targetObject.bbox, evidenceQuality, score);
                    
                    // å“è³ªã«å¿œã˜ãŸã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¡¨ç¤º
                    const qualityText = getQualityDisplayText(evidenceQuality);
                    showScanEffect(`âœ¨ ${qualityText}è¨¼æ‹ ç™ºè¦‹ï¼\n${japaneseName}\n+${score}pts`, tapX, tapY);
                } else {
                    showScanEffect(`ğŸ“ ${japaneseName}\nä¸€èˆ¬ç‰©ä½“`, tapX, tapY);
                }
                
            } catch (error) {
                console.error('ç‰©ä½“æ¤œçŸ¥ã‚¨ãƒ©ãƒ¼:', error);
                showScanEffect('âŒ æ¤œçŸ¥ã‚¨ãƒ©ãƒ¼', tapX, tapY);
            }
        }
        
        // ã‚¿ãƒƒãƒ—ä½ç½®ã®ç‰©ä½“ã‚’æ¤œç´¢
        function findObjectAtPosition(predictions, tapX, tapY) {
            let closestObject = null;
            let minDistance = Infinity;
            
            predictions.forEach(prediction => {
                const [x, y, width, height] = prediction.bbox;
                
                // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å†…ã‹ãƒã‚§ãƒƒã‚¯
                if (tapX >= x && tapX <= x + width && tapY >= y && tapY <= y + height) {
                    // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å†…ã®å ´åˆã€ä¸­å¿ƒã‹ã‚‰ã®è·é›¢ã‚’è¨ˆç®—
                    const centerX = x + width / 2;
                    const centerY = y + height / 2;
                    const distance = Math.sqrt(Math.pow(tapX - centerX, 2) + Math.pow(tapY - centerY, 2));
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestObject = prediction;
                    }
                }
            });
            
            // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å†…ã«ç‰©ä½“ãŒãªã„å ´åˆã€æœ€ã‚‚è¿‘ã„ç‰©ä½“ã‚’æ¤œç´¢
            if (!closestObject) {
                predictions.forEach(prediction => {
                    const [x, y, width, height] = prediction.bbox;
                    const centerX = x + width / 2;
                    const centerY = y + height / 2;
                    const distance = Math.sqrt(Math.pow(tapX - centerX, 2) + Math.pow(tapY - centerY, 2));
                    
                    // ä¸€å®šè·é›¢å†…ã®ç‰©ä½“ã®ã¿å¯¾è±¡
                    if (distance < 100 && distance < minDistance) {
                        minDistance = distance;
                        closestObject = prediction;
                    }
                });
            }
            
            return closestObject;
        }
        
        // ã‚¿ãƒƒãƒ—ã—ãŸç‰©ä½“ã‚’å¼·èª¿è¡¨ç¤º
        function highlightTappedObject(prediction, ctx, tapX, tapY) {
            const [x, y, width, height] = prediction.bbox;
            const className = prediction.class;
            const confidence = Math.round(prediction.score * 100);
            const japaneseName = objectNames[className] || className;
            
            // ç‰©ä½“ã®ç¨®é¡ã«å¿œã˜ãŸè‰²è¨­å®š
            const isEvidence = evidenceHints[className];
            const collectedTypes = gameState.evidence.map(e => e.type);
            const isCollected = collectedTypes.includes(className);
            const dynamicThreshold = getDynamicThreshold(className);
            const meetsThreshold = confidence >= dynamicThreshold;
            
            let boxColor;
            if (isEvidence && meetsThreshold && !isCollected) {
                boxColor = '#00ff00'; // ç·‘: æ–°ã—ã„è¨¼æ‹ 
            } else if (isEvidence && isCollected) {
                boxColor = '#ffaa00'; // é»„: åé›†æ¸ˆã¿
            } else if (isEvidence && !meetsThreshold) {
                boxColor = '#ff6600'; // ã‚ªãƒ¬ãƒ³ã‚¸: ä¿¡é ¼åº¦ä¸è¶³
            } else {
                boxColor = '#666666'; // ç°: ä¸€èˆ¬ç‰©ä½“
            }
            
            // å¼·èª¿ã•ã‚ŒãŸãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹
            ctx.strokeStyle = boxColor;
            ctx.lineWidth = 4;
            ctx.strokeRect(x, y, width, height);
            
            // ã‚¿ãƒƒãƒ—ä½ç½®ã‹ã‚‰ç‰©ä½“ã¸ã®ç·š
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(tapX, tapY);
            ctx.lineTo(x + width/2, y + height/2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ãƒ©ãƒ™ãƒ«
            const labelText = `${japaneseName} ${confidence}%`;
            ctx.font = 'bold 16px Arial';
            const textWidth = ctx.measureText(labelText).width;
            
            // ãƒ©ãƒ™ãƒ«èƒŒæ™¯
            ctx.fillStyle = boxColor + 'CC';
            ctx.fillRect(x, y - 30, textWidth + 20, 25);
            
            // ãƒ©ãƒ™ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ
            ctx.fillStyle = '#ffffff';
            ctx.fillText(labelText, x + 10, y - 10);
        }

        // æ—§ã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½ï¼ˆä½¿ç”¨ã—ãªã„ï¼‰
        async function scanForEvidence() {
            if (!gameState.isModelLoaded) {
                alert('AIã‚·ã‚¹ãƒ†ãƒ ãŒã¾ã èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“');
                return;
            }

            if (gameState.evidence.length >= 5) {
                // æ¨ç†ãƒ•ã‚§ãƒ¼ã‚ºã¸
                startDeductionPhase();
                return;
            }

            // ã‚¹ã‚­ãƒ£ãƒ³éŸ³å†ç”Ÿ
            audioManager.playSound('scanSound');

            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            try {
                // è¶…é«˜ç²¾åº¦ç‰©ä½“æ¤œå‡ºå®Ÿè¡Œï¼ˆãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸æ¤œå‡ºï¼‰
                let allPredictions = [];
                
                // ã‚¹ãƒ†ãƒ¼ã‚¸1: æœ€é«˜ç²¾åº¦æ¤œå‡ºï¼ˆ7å›ï¼‰
                const ultraHighPrecisionConfig = {
                    maxNumBoxes: 150,       // æ¤œå‡ºæ•°ã‚’æœ€å¤§åŒ–
                    iouThreshold: 0.05,     // é‡è¤‡é™¤å»ã‚’æœ€å°åŒ–
                    scoreThreshold: 0.03    // ä¿¡é ¼åº¦é–¾å€¤ã‚’æœ€ä½ã«
                };
                
                for (let attempt = 0; attempt < 7; attempt++) {
                    const predictions = await gameState.model.detect(
                        video, 
                        ultraHighPrecisionConfig.maxNumBoxes, 
                        ultraHighPrecisionConfig.scoreThreshold
                    );
                    allPredictions = allPredictions.concat(predictions);
                    
                    // ãƒ•ãƒ¬ãƒ¼ãƒ é–“å¤‰åŒ–ã‚’åˆ©ç”¨ã—ãŸå¤šé‡æ¤œå‡º
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
                
                // ã‚¹ãƒ†ãƒ¼ã‚¸2: ä¸­ç²¾åº¦æ¤œå‡ºï¼ˆ4å›ï¼‰
                const mediumPrecisionConfig = {
                    maxNumBoxes: 100,
                    iouThreshold: 0.1,
                    scoreThreshold: 0.08
                };
                
                for (let attempt = 0; attempt < 4; attempt++) {
                    const predictions = await gameState.model.detect(
                        video, 
                        mediumPrecisionConfig.maxNumBoxes, 
                        mediumPrecisionConfig.scoreThreshold
                    );
                    allPredictions = allPredictions.concat(predictions);
                    await new Promise(resolve => setTimeout(resolve, 75));
                }
                
                // ã‚¹ãƒ†ãƒ¼ã‚¸3: æ¨™æº–æ¤œå‡ºï¼ˆ2å›ï¼‰
                const standardConfig = {
                    maxNumBoxes: 50,
                    iouThreshold: 0.2,
                    scoreThreshold: 0.15
                };
                
                for (let attempt = 0; attempt < 2; attempt++) {
                    const predictions = await gameState.model.detect(
                        video, 
                        standardConfig.maxNumBoxes, 
                        standardConfig.scoreThreshold
                    );
                    allPredictions = allPredictions.concat(predictions);
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // é‡è¤‡é™¤å»ã¨ä¿¡é ¼åº¦é›†ç´„
                const aggregatedPredictions = aggregatePredictions(allPredictions);
                
                console.log(`æ¤œå‡ºçµæœ: ${aggregatedPredictions.length}å€‹ã®ç‰©ä½“`);
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // æ¤œå‡ºã•ã‚ŒãŸç‰©ä½“ã‚’å‡¦ç†ï¼ˆé‡è¤‡é™¤å¤–æ©Ÿèƒ½ä»˜ãï¼‰
                let newEvidence = false;
                
                // æ—¢ã«åé›†æ¸ˆã¿ã®è¨¼æ‹ ã‚¿ã‚¤ãƒ—ã‚’ãƒªã‚¹ãƒˆåŒ–
                const collectedTypes = gameState.evidence.map(e => e.type);
                console.log('æ—¢ã«åé›†æ¸ˆã¿ã®è¨¼æ‹ :', collectedTypes);
                
                for (const prediction of aggregatedPredictions) {
                    const objectType = prediction.class;
                    const confidence = Math.round(prediction.score * 100);
                    
                    // ã‚¯ãƒ©ã‚¹åˆ¥ã®å‹•çš„ä¿¡é ¼åº¦é–¾å€¤
                    const dynamicThreshold = getDynamicThreshold(objectType);
                    if (confidence < dynamicThreshold) continue;
                    
                    // æ—¢ã«åé›†æ¸ˆã¿ã®è¨¼æ‹ ã‚¿ã‚¤ãƒ—ã¯å®Œå…¨ã«ã‚¹ã‚­ãƒƒãƒ—
                    if (collectedTypes.includes(objectType)) {
                        console.log(`ã‚¹ã‚­ãƒƒãƒ—: ${objectType} (æ—¢ã«åé›†æ¸ˆã¿)`);
                        continue;
                    }
                    
                    // è¨¼æ‹ ã¨ã—ã¦è¨˜éŒ²å¯èƒ½ãªç‰©ä½“ã®ã¿
                    if (evidenceHints[objectType]) {
                        console.log(`æ–°ã—ã„è¨¼æ‹ ç™ºè¦‹: ${objectType} (ä¿¡é ¼åº¦: ${confidence}%)`);
                        addEvidence(objectType, prediction.bbox);
                        newEvidence = true;
                        break; // ä¸€åº¦ã«1ã¤ã®è¨¼æ‹ ã®ã¿
                    }
                }
                
                // æ¤œå‡ºã•ã‚ŒãŸå…¨ç‰©ä½“ã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
                drawAllDetections(aggregatedPredictions, ctx);
                
                if (!newEvidence && aggregatedPredictions.length > 0) {
                    showScanEffect('âŒ è¨¼æ‹ ãªã—', canvas.width / 2, canvas.height / 2);
                } else if (aggregatedPredictions.length === 0) {
                    showScanEffect('ğŸ” æ¤œå‡ºãªã—', canvas.width / 2, canvas.height / 2);
                }
                
            } catch (error) {
                console.error('ã‚¹ã‚­ãƒ£ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // è¨¼æ‹ å“è³ªåˆ¤å®š
        function getEvidenceQuality(objectType) {
            if (!gameState.currentScenario) return 'supporting';
            
            const scenario = gameState.currentScenario;
            return scenario.specialEvidence[objectType] || 'supporting';
        }
        
        // è¨¼æ‹ ã‚¹ã‚³ã‚¢è¨ˆç®—
        function calculateEvidenceScore(quality, confidence) {
            const baseScores = {
                'decisive': 100,
                'circumstantial': 60,
                'supporting': 30,
                'false': -20
            };
            
            const baseScore = baseScores[quality] || 30;
            const confidenceBonus = Math.round((confidence - 50) * 0.5); // ä¿¡é ¼åº¦ãƒœãƒ¼ãƒŠã‚¹
            
            return Math.max(baseScore + confidenceBonus, quality === 'false' ? -20 : 10);
        }
        
        // å“è³ªè¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
        function getQualityDisplayText(quality) {
            const qualityTexts = {
                'decisive': 'ğŸ”´æ±ºå®šçš„',
                'circumstantial': 'ğŸŸ¡çŠ¶æ³',
                'supporting': 'ğŸ”µè£œåŠ©',
                'false': 'âš«å½'
            };
            
            return qualityTexts[quality] || 'ğŸ”µè£œåŠ©';
        }
        
        // å“è³ªã«å¿œã˜ãŸè‰²å–å¾—
        function getQualityColor(quality) {
            const qualityColors = {
                'decisive': '#ff0000',
                'circumstantial': '#ffaa00',
                'supporting': '#0088ff',
                'false': '#666666'
            };
            
            return qualityColors[quality] || '#0088ff';
        }

        // è¨¼æ‹ è¿½åŠ 
        function addEvidence(objectType, bbox, quality = 'supporting', score = 30) {
            const hints = evidenceHints[objectType];
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            const japaneseName = objectNames[objectType] || objectType;
            
            const evidence = {
                type: objectType,
                name: japaneseName,
                hint: randomHint,
                bbox: bbox,
                quality: quality,
                score: score,
                timestamp: new Date()
            };
            
            gameState.evidence.push(evidence);
            gameState.score += score;
            updateEvidenceUI();
            
            // éŸ³éŸ¿åŠ¹æœã¨ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            audioManager.playSound('evidenceSound');
            const [x, y] = bbox;
            showScanEffect('âœ¨ è¨¼æ‹ ç™ºè¦‹ï¼', x + bbox[2] / 2, y);
            
            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœï¼ˆå“è³ªã«å¿œã˜ãŸè‰²ï¼‰
            const particleColor = getQualityColor(quality);
            createParticles(5, x + bbox[2] / 2, y, particleColor);
            
            // ç›®æ¨™è¨¼æ‹ æ•°ã«é”ã—ãŸã‚‰æ¨ç†ãƒ•ã‚§ãƒ¼ã‚ºã¸
            const targetCount = gameState.currentScenario ? gameState.currentScenario.targetEvidence.length : 5;
            if (gameState.evidence.length >= targetCount) {
                setTimeout(() => {
                    startDeductionPhase();
                }, 2000);
            }
        }

        // è¨¼æ‹ UIæ›´æ–°
        function updateEvidenceUI() {
            const targetCount = gameState.currentScenario ? gameState.currentScenario.targetEvidence.length : 5;
            const count = document.getElementById('evidenceCount');
            count.textContent = `${gameState.evidence.length} / ${targetCount}`;
            
            // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’è¿½åŠ 
            const scoreDisplay = document.querySelector('.score-display') || (() => {
                const scoreEl = document.createElement('div');
                scoreEl.className = 'score-display';
                scoreEl.style.cssText = `
                    position: absolute;
                    top: 120px;
                    right: 20px;
                    background: rgba(0, 0, 0, 0.8);
                    color: #fff;
                    padding: 10px;
                    border-radius: 8px;
                    font-size: 0.9rem;
                    border: 1px solid #ff0000;
                `;
                document.querySelector('.game-ui').appendChild(scoreEl);
                return scoreEl;
            })();
            
            scoreDisplay.innerHTML = `
                ğŸ“Š ã‚¹ã‚³ã‚¢: ${gameState.score}/${gameState.maxScore}<br>
                ğŸ¯ é€²æ—: ${Math.round((gameState.score / gameState.maxScore) * 100)}%
            `;
            
            const list = document.getElementById('evidenceList');
            list.innerHTML = '';
            
            gameState.evidence.forEach((evidence, index) => {
                const item = document.createElement('div');
                item.className = 'evidence-item';
                
                // å“è³ªã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«
                const qualityColor = getQualityColor(evidence.quality || 'supporting');
                const qualityText = getQualityDisplayText(evidence.quality || 'supporting');
                
                item.style.borderLeft = `4px solid ${qualityColor}`;
                
                item.innerHTML = `
                    <div class="object-name">
                        ${qualityText} è¨¼æ‹ ${index + 1}: ${evidence.name}
                        <span style="float: right; color: ${qualityColor};">+${evidence.score || 30}pts</span>
                    </div>
                    <div class="hint">${evidence.hint}</div>
                `;
                list.appendChild(item);
            });
        }

        // ã‚¹ã‚­ãƒ£ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function showScanEffect(text, x, y) {
            const effect = document.createElement('div');
            effect.className = 'scan-effect';
            
            // æ”¹è¡Œã‚’<br>ã«å¤‰æ›
            effect.innerHTML = text.replace(/\n/g, '<br>');
            
            effect.style.cssText = `
                position: absolute;
                left: ${x}px;
                top: ${y}px;
                transform: translate(-50%, -100%);
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 8px 12px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: bold;
                text-align: center;
                pointer-events: none;
                z-index: 1000;
                white-space: nowrap;
                border: 2px solid #fff;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
                animation: scanPop 1s ease-out forwards;
            `;
            
            document.getElementById('gameScreen').appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 2000);
        }

        // æ¨ç†ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹
        function startDeductionPhase() {
            gameState.phase = 'deduction';
            
            // é€£ç¶šæ¤œå‡ºåœæ­¢
            stopContinuousDetection();
            
            // ã‚«ãƒ¡ãƒ©åœæ­¢
            if (gameState.stream) {
                gameState.stream.getTracks().forEach(track => track.stop());
            }
            
            // BGMåœæ­¢
            audioManager.stopBGM();
            
            // çŠ¯äººå€™è£œç”Ÿæˆ
            generateSuspects();
            
            // UIåˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('deductionPhase').classList.add('active');
        }

        // çŠ¯äººå€™è£œç”Ÿæˆ
        function generateSuspects() {
            // åé›†ã—ãŸè¨¼æ‹ ã«åŸºã¥ã„ã¦çŠ¯äººå€™è£œã‚’ç”Ÿæˆ
            const evidenceTypes = gameState.evidence.map(e => e.type);
            
            // å„çŠ¯äººã‚¿ã‚¤ãƒ—ã®ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
            const suspectScores = criminalTypes.map(criminal => {
                const score = criminal.relatedEvidence.filter(e => 
                    evidenceTypes.includes(e)
                ).length;
                
                return { ...criminal, score };
            });
            
            // ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
            suspectScores.sort((a, b) => b.score - a.score);
            
            // ä¸Šä½3äººã‚’å€™è£œã«
            gameState.suspects = suspectScores.slice(0, 3);
            
            // çœŸçŠ¯äººã‚’æ±ºå®šï¼ˆæœ€é«˜ã‚¹ã‚³ã‚¢ã‹ã‚‰ç¢ºç‡çš„ã«ï¼‰
            const rand = Math.random();
            if (rand < 0.6) {
                gameState.trueCriminal = gameState.suspects[0];
            } else if (rand < 0.85) {
                gameState.trueCriminal = gameState.suspects[1];
            } else {
                gameState.trueCriminal = gameState.suspects[2];
            }
            
            // ãƒ€ãƒŸãƒ¼å€™è£œã‚’è¿½åŠ ï¼ˆãƒŸã‚¹ãƒªãƒ¼ãƒ‰ç”¨ï¼‰
            const dummyCriminal = {
                name: 'é€šã‚Šã™ãŒã‚Šã®äººç‰©',
                description: 'å¶ç„¶ç¾å ´ã«ã„ãŸã ã‘ã®ç„¡é–¢ä¿‚ãªäººç‰©',
                score: 0
            };
            gameState.suspects.push(dummyCriminal);
            
            // UIè¡¨ç¤º
            displaySuspects();
        }

        // çŠ¯äººå€™è£œè¡¨ç¤º
        function displaySuspects() {
            const suspectList = document.getElementById('suspectList');
            suspectList.innerHTML = '';
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã³æ›¿ãˆ
            const shuffled = [...gameState.suspects].sort(() => Math.random() - 0.5);
            
            shuffled.forEach(suspect => {
                const card = document.createElement('div');
                card.className = 'suspect-card';
                card.innerHTML = `
                    <div class="suspect-name">${suspect.name}</div>
                    <div class="suspect-description">${suspect.description}</div>
                `;
                card.onclick = () => selectSuspect(suspect);
                suspectList.appendChild(card);
            });
        }

        // çŠ¯äººé¸æŠ
        function selectSuspect(suspect) {
            gameState.phase = 'result';
            
            const isCorrect = suspect.name === gameState.trueCriminal.name;
            
            // çµæœç”»é¢è¡¨ç¤º
            showResult(isCorrect, suspect);
        }

        // çµæœè¡¨ç¤º
        function showResult(isCorrect, selectedSuspect) {
            const resultScreen = document.getElementById('resultScreen');
            
            // éŸ³éŸ¿åŠ¹æœ
            if (isCorrect) {
                audioManager.playSound('successSound');
                createParticles(20, window.innerWidth / 2, window.innerHeight / 2);
            } else {
                audioManager.playSound('failSound');
            }
            
            // æœ€çµ‚ã‚¹ã‚³ã‚¢è¨ˆç®—
            const finalScore = isCorrect ? gameState.score + 200 : gameState.score;
            const scorePercentage = Math.round((finalScore / gameState.maxScore) * 100);
            const rank = scorePercentage >= 90 ? 'S' : 
                        scorePercentage >= 80 ? 'A' : 
                        scorePercentage >= 70 ? 'B' : 
                        scorePercentage >= 60 ? 'C' : 'D';

            if (isCorrect) {
                resultScreen.innerHTML = `
                    <div class="result-success">
                        <h2>ğŸ‰ äº‹ä»¶è§£æ±ºï¼</h2>
                        <div class="result-message">
                            è¦‹äº‹ã ï¼å›ã®æ¨ç†ã¯æ­£ã—ã‹ã£ãŸã€‚<br>
                            çŠ¯äººã¯ã€Œ${selectedSuspect.name}ã€ã ã£ãŸã€‚<br><br>
                            ${gameState.currentScenario.name}ã¯è§£æ±ºã•ã‚ŒãŸã€‚<br>
                            ${generateSuccessStory()}
                        </div>
                        <div style="background: rgba(0, 255, 0, 0.1); border: 1px solid #00ff00; 
                                    padding: 15px; border-radius: 10px; margin: 20px 0;">
                            <div style="font-size: 1.5rem; margin-bottom: 10px;">
                                ğŸ† è©•ä¾¡ãƒ©ãƒ³ã‚¯: <span style="color: #00ff00; font-weight: bold;">${rank}</span>
                            </div>
                            <div>ğŸ“Š æœ€çµ‚ã‚¹ã‚³ã‚¢: ${finalScore}/${gameState.maxScore} (${scorePercentage}%)</div>
                            <div>ğŸ” è¨¼æ‹ åé›†: ${gameState.evidence.length}å€‹</div>
                            <div>â­ æ¨ç†æ­£è§£ãƒœãƒ¼ãƒŠã‚¹: +200pts</div>
                        </div>
                        <button class="retry-button" onclick="location.reload()">ğŸ”„ æ–°ã—ã„äº‹ä»¶ã¸</button>
                    </div>
                `;
            } else {
                resultScreen.innerHTML = `
                    <div class="result-fail">
                        <h2>ğŸ’€ æ¨ç†å¤±æ•—...</h2>
                        <div class="result-message">
                            é•ã†...çŠ¯äººã¯ã€Œ${gameState.trueCriminal.name}ã€ã ã£ãŸã€‚<br><br>
                            ${gameState.currentScenario.name}ã¯æœªè§£æ±ºã¨ãªã£ãŸã€‚<br>
                            ${generateFailStory()}
                        </div>
                        <div style="background: rgba(255, 0, 0, 0.1); border: 1px solid #ff0000; 
                                    padding: 15px; border-radius: 10px; margin: 20px 0;">
                            <div style="font-size: 1.5rem; margin-bottom: 10px;">
                                ğŸ“‰ è©•ä¾¡ãƒ©ãƒ³ã‚¯: <span style="color: #ff6666; font-weight: bold;">${rank}</span>
                            </div>
                            <div>ğŸ“Š æœ€çµ‚ã‚¹ã‚³ã‚¢: ${finalScore}/${gameState.maxScore} (${scorePercentage}%)</div>
                            <div>ğŸ” è¨¼æ‹ åé›†: ${gameState.evidence.length}å€‹</div>
                            <div>âŒ æ¨ç†ä¸æ­£è§£: ãƒœãƒ¼ãƒŠã‚¹ãªã—</div>
                            <div style="margin-top: 10px; font-size: 0.9rem; color: #ccc;">
                                æ­£è§£: ${gameState.trueCriminal.name} - ${gameState.currentScenario.criminalProfile.motive}
                            </div>
                        </div>
                        <button class="retry-button" onclick="location.reload()">ğŸ”„ ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
                    </div>
                `;
            }
            
            document.getElementById('deductionPhase').style.display = 'none';
            resultScreen.classList.add('active');
        }

        // æˆåŠŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”Ÿæˆ
        function generateSuccessStory() {
            const stories = [
                'è¨¼æ‹ ã®ç©ã¿é‡ã­ãŒã€çŠ¯äººã‚’è¿½ã„è©°ã‚ãŸã€‚',
                'å›ã®é‹­ã„è¦³å¯Ÿçœ¼ãŒã€çœŸå®Ÿã‚’è¦‹æŠœã„ãŸã€‚',
                'è«–ç†çš„ãªæ¨ç†ãŒã€äº‹ä»¶ã®å…¨è²Œã‚’æ˜ã‚‰ã‹ã«ã—ãŸã€‚',
                'å°ã•ãªæ‰‹ãŒã‹ã‚Šã‚‚è¦‹é€ƒã•ãªã„ã€åæ¢åµã®èª•ç”Ÿã ã€‚'
            ];
            return stories[Math.floor(Math.random() * stories.length)];
        }

        // å¤±æ•—ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”Ÿæˆ
        function generateFailStory() {
            const stories = [
                'è¨¼æ‹ ã®è¦‹è½ã¨ã—ãŒã€è‡´å‘½çš„ãªãƒŸã‚¹ã¨ãªã£ãŸã€‚',
                'æ€ã„è¾¼ã¿ãŒã€çœŸå®Ÿã‹ã‚‰ç›®ã‚’èƒŒã‘ã•ã›ãŸã€‚',
                'çŠ¯äººã®å·§å¦™ãªç½ ã«ã€ã¾ã‚“ã¾ã¨å¼•ã£ã‹ã‹ã£ã¦ã—ã¾ã£ãŸã€‚',
                'ã‚‚ã†å°‘ã—ã§çœŸå®Ÿã«è¾¿ã‚Šç€ã‘ãŸã®ã«...'
            ];
            return stories[Math.floor(Math.random() * stories.length)];
        }

        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«åŠ¹æœ
        function createParticles(count, centerX = null, centerY = null, color = '#ffff00') {
            const container = document.body;
            
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const x = centerX || Math.random() * window.innerWidth;
                const y = centerY || Math.random() * window.innerHeight;
                
                particle.style.cssText = `
                    position: absolute;
                    left: ${x}px;
                    top: ${y}px;
                    width: 8px;
                    height: 8px;
                    background: ${color};
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 1000;
                    animation: particleFall 2s ease-out forwards;
                    animation-delay: ${Math.random() * 0.5}s;
                `;
                
                container.appendChild(particle);
                
                // 2ç§’å¾Œã«å‰Šé™¤
                setTimeout(() => {
                    particle.remove();
                }, 2500);
            }
        }
        
        // 3Dæƒ…å ±ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
        function show3DInfoOverlay(prediction, tapX, tapY, objectType, confidence) {
            // æ—¢å­˜ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å‰Šé™¤
            const existingOverlay = document.querySelector('.info-overlay-3d');
            if (existingOverlay) {
                existingOverlay.remove();
            }
            
            const [x, y, width, height] = prediction.bbox;
            const japaneseName = objectNames[objectType] || objectType;
            const evidenceQuality = getEvidenceQuality(objectType);
            const isEvidence = evidenceHints[objectType];
            const collectedTypes = gameState.evidence.map(e => e.type);
            const isCollected = collectedTypes.includes(objectType);
            
            // è©³ç´°åˆ†æãƒ‡ãƒ¼ã‚¿
            const analysisData = generateAdvancedAnalysis(objectType, confidence);
            
            // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãƒ‘ãƒãƒ«ä½œæˆ
            const overlay = document.createElement('div');
            overlay.className = 'info-overlay-3d';
            
            // ç”»é¢åº§æ¨™ã«å¤‰æ›
            const canvas = document.getElementById('canvas');
            const rect = canvas.getBoundingClientRect();
            const screenX = (x + width/2) * (rect.width / canvas.width) + rect.left;
            const screenY = y * (rect.height / canvas.height) + rect.top;
            
            const qualityColor = getQualityColor(evidenceQuality);
            const qualityText = getQualityDisplayText(evidenceQuality);
            
            overlay.style.cssText = `
                position: absolute;
                left: ${screenX}px;
                top: ${screenY - 20}px;
                transform: translate(-50%, -100%);
                background: rgba(0, 0, 0, 0.95);
                border: 2px solid ${qualityColor};
                border-radius: 12px;
                padding: 15px;
                min-width: 280px;
                max-width: 350px;
                z-index: 1500;
                color: white;
                font-size: 13px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                animation: overlayFloat 0.5s ease-out;
                pointer-events: all;
            `;
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ
            let statusIcon = '';
            let statusText = '';
            
            if (isCollected) {
                statusIcon = 'âœ…';
                statusText = 'åé›†æ¸ˆã¿';
            } else if (isEvidence) {
                statusIcon = evidenceQuality === 'decisive' ? 'ğŸ”´' : 
                             evidenceQuality === 'circumstantial' ? 'ğŸŸ¡' : 
                             evidenceQuality === 'false' ? 'âš«' : 'ğŸ”µ';
                statusText = isEvidence ? 'è¨¼æ‹ å€™è£œ' : 'ä¸€èˆ¬ç‰©ä½“';
            } else {
                statusIcon = 'ğŸ“';
                statusText = 'ä¸€èˆ¬ç‰©ä½“';
            }
            
            overlay.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <div style="font-size: 24px; margin-right: 10px;">${statusIcon}</div>
                    <div>
                        <div style="font-weight: bold; color: ${qualityColor}; font-size: 16px;">${japaneseName}</div>
                        <div style="color: #ccc; font-size: 11px;">${statusText} | ä¿¡é ¼åº¦: ${confidence}%</div>
                    </div>
                </div>
                
                ${isEvidence ? `
                <div style="background: rgba(${qualityColor.slice(1,3)}, ${qualityColor.slice(3,5)}, ${qualityColor.slice(5,7)}, 0.2); 
                           padding: 8px; border-radius: 6px; margin-bottom: 10px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">${qualityText} è¨¼æ‹ </div>
                    <div style="font-size: 11px; line-height: 1.4;">
                        ${evidenceHints[objectType][0]}
                    </div>
                </div>
                ` : ''}
                
                <div style="border-top: 1px solid #333; padding-top: 8px; margin-top: 8px;">
                    <div style="font-weight: bold; margin-bottom: 5px; color: #ff6666;">ğŸ”¬ AIåˆ†æçµæœ</div>
                    <div style="font-size: 11px; line-height: 1.3;">
                        ${analysisData.condition}<br>
                        ${analysisData.context}<br>
                        ${analysisData.significance}
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 10px;">
                    <button onclick="closeInfoOverlay()" style="
                        background: ${qualityColor};
                        color: white;
                        border: none;
                        padding: 6px 15px;
                        border-radius: 15px;
                        font-size: 11px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    ">é–‰ã˜ã‚‹</button>
                </div>
            `;
            
            document.getElementById('gameScreen').appendChild(overlay);
            
            // 3ç§’å¾Œã«è‡ªå‹•ã§é–‰ã˜ã‚‹
            setTimeout(() => {
                if (overlay.parentNode) {
                    overlay.remove();
                }
            }, 5000);
        }
        
        // é«˜åº¦ãªAIåˆ†æãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        function generateAdvancedAnalysis(objectType, confidence) {
            const analysisTemplates = {
                'cup': {
                    condition: ['è¡¨é¢ã«æŒ‡ç´‹ç—•è·¡ã‚ã‚Š', 'æ¶²ä½“ã®æ®‹ç•™ç‰©ã‚’æ¤œå‡º', 'å–ã£æ‰‹éƒ¨åˆ†ã«æ‘©è€—è·¡', 'å£ç´…ã®ä»˜ç€ã‚’ç¢ºèª'],
                    context: ['æœ€è¿‘ä½¿ç”¨ã•ã‚ŒãŸå½¢è·¡', 'è¤‡æ•°äººã«ã‚ˆã‚‹ä½¿ç”¨ã®å¯èƒ½æ€§', 'æ€¥ã„ã§ç½®ã‹ã‚ŒãŸç—•è·¡', 'æ¸©åº¦å·®ã«ã‚ˆã‚‹çµéœ²'],
                    significance: ['DNAæ¡å–å¯èƒ½', 'æ™‚ç³»åˆ—æ¨å®šã®æ‰‹ãŒã‹ã‚Š', 'é–¢ä¿‚è€…ç‰¹å®šã«æœ‰åŠ¹', 'é£²ç”¨ç‰©è³ªã®åˆ†æå¯èƒ½']
                },
                'book': {
                    condition: ['ãƒšãƒ¼ã‚¸ã«è¡€ç—•ã‚’æ¤œå‡º', 'è¡¨ç´™ã«æå‚·ã‚ã‚Š', 'ã—ãŠã‚Šã®ä½ç½®ãŒä¸è‡ªç„¶', 'ç‰¹å®šãƒšãƒ¼ã‚¸ãŒé–‹ã„ãŸã¾ã¾'],
                    context: ['äº‰ã„ã®æœ€ä¸­ã«ä½¿ç”¨', 'éš è”½å·¥ä½œã®å¯èƒ½æ€§', 'é‡è¦ãªæƒ…å ±ãŒè¨˜è¼‰', 'ãƒ€ã‚¤ã‚¤ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¯èƒ½æ€§'],
                    significance: ['ç¾å ´ã®çŠ¶æ³ã‚’ç¤ºå”†', 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ€§ã‚ã‚Š', 'å‹•æ©Ÿè§£æ˜ã®éµ', 'æ™‚åˆ»ç‰¹å®šã«æœ‰åŠ¹']
                },
                'scissors': {
                    condition: ['åˆƒéƒ¨ã«è¡€æ¶²ä»˜ç€', 'æŒ‡ç´‹ãŒæ˜ç­ã«æ®‹å­˜', 'åˆƒã“ã¼ã‚Œã‚’ç¢ºèª', 'ç¹Šç¶­ç‰‡ãŒæŒŸã¾ã£ã¦ã„ã‚‹'],
                    context: ['å‡¶å™¨ã¨ã—ã¦ä½¿ç”¨', 'æ¿€ã—ã„æŠµæŠ—ãŒã‚ã£ãŸ', 'è¨ˆç”»çš„çŠ¯è¡Œã®è¨¼æ‹ ', 'åˆ‡æ–­ç—•ãŒè¤‡æ•°ç®‡æ‰€ã«'],
                    significance: ['æ±ºå®šçš„ãªç‰©çš„è¨¼æ‹ ', 'çŠ¯äººç‰¹å®šå¯èƒ½', 'DNAé‘‘å®šå¿…é ˆ', 'çŠ¯è¡Œæ‰‹é †ã®å†ç¾å¯èƒ½']
                },
                'knife': {
                    condition: ['è¡€æ¶²åå¿œé™½æ€§', 'åˆƒæ–‡ã«ç•°ç‰©ä»˜ç€', 'æŸ„éƒ¨åˆ†ã«åœ§è¿«ç—•', 'åˆ‡ã‚Œå‘³ã®å¤‰åŒ–'],
                    context: ['ä¸»è¦å‡¶å™¨ã¨æ¨å®š', 'é˜²å¾¡å‰µã®å¯èƒ½æ€§', 'è¨ˆç”»æ€§ã®é«˜ã„çŠ¯è¡Œ', 'è¤‡æ•°å›ã®ä½¿ç”¨'],
                    significance: ['è‡´å‘½å‚·ã¨ã®ä¸€è‡´æ€§', 'çŠ¯äººã®èº«ä½“ç‰¹å¾´æ¨å®š', 'çŠ¯è¡Œæ™‚é–“ã®ç‰¹å®š', 'å‹•æ©Ÿã®è§£æ˜']
                },
                'bottle': {
                    condition: ['ç ´æãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è§£æ', 'å†…å®¹ç‰©ã®æ®‹ç•™', 'æŒ‡ç´‹ã®é‡è¤‡æ¤œå‡º', 'è¡æ’ƒç—•ã®åˆ†æ'],
                    context: ['æŠ•æ“²æ­¦å™¨ã¨ã—ã¦ä½¿ç”¨', 'é£²é…’ã®ç—•è·¡', 'äº‰ã„ã®æ¿€åŒ–', 'è¡å‹•çš„è¡Œå‹•'],
                    significance: ['åŠ›ã®æ–¹å‘æ€§åˆ¤å®š', 'ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«æ¿ƒåº¦æ¸¬å®š', 'æŠ•æ“²è€…ã®ç‰¹å®š', 'äº‹ä»¶ã®çµŒéæ¨å®š']
                },
                'laptop': {
                    condition: ['é›»æºçŠ¶æ…‹ã‚’ç¢ºèª', 'æœ€çµ‚æ“ä½œæ™‚åˆ»è¨˜éŒ²', 'ç”»é¢ã«æå‚·', 'ãƒ‡ãƒ¼ã‚¿æ”¹ç«„ã®ç—•è·¡'],
                    context: ['ä½œæ¥­ä¸­ã®ä¸­æ–­', 'æƒ…å ±æ¼æ´©ã®å¯èƒ½æ€§', 'é‡‘éŠ­çš„å‹•æ©Ÿ', 'ã‚µã‚¤ãƒãƒ¼çŠ¯ç½ªã®é–¢ä¸'],
                    significance: ['ãƒ‡ã‚¸ã‚¿ãƒ«è¨¼æ‹ ã®å®åº«', 'å‹•æ©Ÿã®è§£æ˜', 'å…±çŠ¯è€…ã®å­˜åœ¨', 'æ™‚ç³»åˆ—ã®ç¢ºå®š']
                },
                'cell phone': {
                    condition: ['é€šè©±å±¥æ­´ã‚’è§£æ', 'GPSä½ç½®æƒ…å ±è¨˜éŒ²', 'ç”»é¢ãƒ­ãƒƒã‚¯çŠ¶æ…‹', 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœªèª­'],
                    context: ['ç·Šæ€¥æ™‚ã®ä½¿ç”¨', 'çŠ¯äººã¨ã®é€£çµ¡', 'ä½ç½®ã®ç‰¹å®š', 'æœ€å¾Œã®è¡Œå‹•'],
                    significance: ['è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ', 'é–¢ä¿‚è€…ã¨ã®æ¥è§¦', 'çŠ¯è¡Œå‰å¾Œã®å‹•å‘', 'ã‚¢ãƒªãƒã‚¤ç¢ºèª']
                },
                'chair': {
                    condition: ['åº§é¢ã®åœ§è¿«ç—•', 'è„šéƒ¨ã®æå‚·', 'è¡€ç—•ã®é£›æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³', 'ç¹Šç¶­ã®ä»˜ç€'],
                    context: ['äº‰ã„ã®éš›ã®ç§»å‹•', 'é˜²å¾¡ã«ä½¿ç”¨', 'ç¾å ´ã®è’å»ƒ', 'ä½“é‡ãƒ»ä½“å‹ã®æ¨å®š'],
                    significance: ['èº«ä½“çš„ç‰¹å¾´ã®æ¨å®š', 'äº‰ã„ã®æ¿€ã—ã•', 'ç¾å ´ã§ã®è¡Œå‹•', 'çŠ¯äººã®èº«é•·æ¨å®š']
                },
                'vase': {
                    condition: ['ç ´ç‰‡ã®æ•£ä¹±ãƒ‘ã‚¿ãƒ¼ãƒ³', 'å†…å®¹ç‰©ã®é£›æ•£', 'æŒã¡æ‰‹ã®æŒ‡ç´‹', 'è¡æ’ƒã®æ–¹å‘æ€§'],
                    context: ['æŠ•æ“²ã«ã‚ˆã‚‹ç ´å£Š', 'è£…é£¾å“ã‹ã‚‰å‡¶å™¨ã¸', 'è¡å‹•çš„è¡Œå‹•', 'æ€’ã‚Šã®è¡¨ç¾'],
                    significance: ['æŠ•æ“²ã®è»Œé“è§£æ', 'çŠ¯äººã®ä½ç½®ç‰¹å®š', 'æ„Ÿæƒ…çš„å‹•æ©Ÿ', 'äº‰ã„ã®å§‹ç‚¹']
                },
                'remote': {
                    condition: ['ãƒœã‚¿ãƒ³ã®æŠ¼ä¸‹ç—•', 'é›»æ± ã®æ¶ˆè€—çŠ¶æ…‹', 'è¨­å®šã®å¤‰æ›´', 'ä½ç½®ã®ç•°å¸¸æ€§'],
                    context: ['æ—¥å¸¸çš„ãªä½¿ç”¨', 'æœ€å¾Œã®æ“ä½œ', 'ç”Ÿæ´»ãƒ‘ã‚¿ãƒ¼ãƒ³', 'æ™‚é–“ã®æ‰‹ãŒã‹ã‚Š'],
                    significance: ['ç”Ÿæ´»ç¿’æ…£ã®åˆ†æ', 'æœ€çµ‚è¡Œå‹•æ™‚åˆ»', 'è¢«å®³è€…ã®çŠ¶æ³', 'ç¾å ´ã®è‡ªç„¶æ€§']
                },
                'clock': {
                    condition: ['åœæ­¢æ™‚åˆ»ã®è¨˜éŒ²', 'é‡ã®ä½ç½®ç•°å¸¸', 'é›»æºã®çŠ¶æ…‹', 'è¨­å®šæ™‚åˆ»ã®ãšã‚Œ'],
                    context: ['çŠ¯è¡Œæ™‚åˆ»ã®ç‰¹å®š', 'è¨ˆç”»æ€§ã®è¨¼æ‹ ', 'ã‚¢ãƒªãƒã‚¤å·¥ä½œ', 'ãƒ€ã‚¤ã‚¤ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'],
                    significance: ['æ­£ç¢ºãªæ™‚åˆ»ç‰¹å®š', 'çŠ¯è¡Œã®è¨ˆç”»æ€§', 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ€§', 'ã‚¢ãƒªãƒã‚¤ã®æ¤œè¨¼']
                }
            };
            
            const template = analysisTemplates[objectType] || {
                condition: ['ç‰©ç†çš„å¤‰åŒ–ã‚’æ¤œå‡º', 'ä½¿ç”¨ç—•è·¡ã‚ã‚Š', 'ä½ç½®ã«ç•°å¸¸æ€§', 'ç’°å¢ƒã¨ã®ä¸æ•´åˆ'],
                context: ['äº‹ä»¶ã¨ã®é–¢é€£æ€§ã‚ã‚Š', 'ç¾å ´ã®çŠ¶æ³ã‚’åæ˜ ', 'æ™‚ç³»åˆ—ã®æ‰‹ãŒã‹ã‚Š', 'è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¤ºå”†'],
                significance: ['æœæŸ»ä¸Šé‡è¦', 'çŠ¶æ³è¨¼æ‹ ã¨ã—ã¦æœ‰åŠ¹', 'é–¢é€£æ€§è¦æ¤œè¨¼', 'ç·åˆçš„åˆ¤æ–­ææ–™']
            };
            
            // ä¿¡é ¼åº¦ã«åŸºã¥ãåˆ†æã®è©³ç´°åº¦èª¿æ•´
            const detailLevel = confidence >= 70 ? 'high' : confidence >= 50 ? 'medium' : 'low';
            
            let analysisResult = {
                condition: template.condition[Math.floor(Math.random() * template.condition.length)],
                context: template.context[Math.floor(Math.random() * template.context.length)],
                significance: template.significance[Math.floor(Math.random() * template.significance.length)]
            };
            
            // é«˜ä¿¡é ¼åº¦ã®å ´åˆã€ã‚ˆã‚Šå…·ä½“çš„ãªåˆ†æã‚’è¿½åŠ 
            if (detailLevel === 'high') {
                analysisResult.additional = generateEnvironmentalContext();
            }
            
            return analysisResult;
        }
        
        // ç’°å¢ƒã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†æ
        function generateEnvironmentalContext() {
            const environmentalFactors = [
                'å®¤æ¸©ãƒ»æ¹¿åº¦ãŒè¨¼æ‹ ä¿å­˜ã«å½±éŸ¿',
                'ç…§æ˜æ¡ä»¶ãŒè¦–èªæ€§ã«é–¢ä¸',
                'éŸ³éŸ¿ç’°å¢ƒãŒè¡Œå‹•ã«åˆ¶ç´„',
                'ç©ºæ°—ã®æµã‚ŒãŒç‰©è³ªç§»å‹•ã«å½±éŸ¿',
                'æ™‚é–“å¸¯ãŒè¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã«é–¢é€£',
                'å­£ç¯€è¦å› ãŒå¿ƒç†çŠ¶æ…‹ã«å½±éŸ¿'
            ];
            
            return environmentalFactors[Math.floor(Math.random() * environmentalFactors.length)];
        }
        
        // AIæ¨ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ©Ÿèƒ½
        function getAIDeductionHint() {
            const evidenceCount = gameState.evidence.length;
            const scenario = gameState.currentScenario;
            
            if (!scenario) return null;
            
            const hints = [
                'åé›†ã—ãŸè¨¼æ‹ é–“ã®é–¢é€£æ€§ã‚’åˆ†æã—ã¦ãã ã•ã„',
                'æ™‚ç³»åˆ—ã®æ•´åˆæ€§ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™',
                'ç‰©ç†çš„è¨¼æ‹ ã¨å¿ƒç†çš„å‹•æ©Ÿã®ä¸€è‡´ã‚’æ¤œè¨¼ã—ã¦ãã ã•ã„',
                'çŠ¯äººã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã«çŸ›ç›¾ãŒãªã„ã‹ç¢ºèªãŒå¿…è¦ã§ã™',
                'è¨¼æ‹ ã®å“è³ªã¨ä¿¡é ¼æ€§ã‚’ç·åˆçš„ã«åˆ¤æ–­ã—ã¦ãã ã•ã„'
            ];
            
            if (evidenceCount >= 3) {
                return {
                    type: 'analysis',
                    message: hints[Math.floor(Math.random() * hints.length)],
                    evidenceTypes: gameState.evidence.map(e => e.type)
                };
            }
            
            return null;
        }
        
        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’é–‰ã˜ã‚‹
        function closeInfoOverlay() {
            const overlay = document.querySelector('.info-overlay-3d');
            if (overlay) {
                overlay.style.animation = 'overlayFadeOut 0.3s ease-in forwards';
                setTimeout(() => overlay.remove(), 300);
            }
        }
        
        // éŸ³é‡åˆ‡ã‚Šæ›¿ãˆ
        function toggleVolume() {
            audioManager.toggleMute();
        }
        
        // åˆæœŸåŒ–
        window.addEventListener('load', () => {
            audioManager.init();
        });
        
        // äºˆæ¸¬çµæœã®é›†ç´„ã¨ç²¾åº¦å‘ä¸Š
        function aggregatePredictions(predictions) {
            const grouped = {};
            
            // åŒã˜ã‚¯ãƒ©ã‚¹ã®äºˆæ¸¬ã‚’é›†ç´„
            predictions.forEach(pred => {
                const className = pred.class;
                if (!grouped[className]) {
                    grouped[className] = [];
                }
                grouped[className].push(pred);
            });
            
            const result = [];
            
            // å„ã‚¯ãƒ©ã‚¹ã®æœ€é«˜ä¿¡é ¼åº¦ã‚’é¸æŠ
            Object.keys(grouped).forEach(className => {
                const classePredictions = grouped[className];
                
                // ä¿¡é ¼åº¦é †ã«ã‚½ãƒ¼ãƒˆ
                classePredictions.sort((a, b) => b.score - a.score);
                
                // æœ€ã‚‚ä¿¡é ¼åº¦ã®é«˜ã„äºˆæ¸¬ã‚’æ¡ç”¨
                const bestPrediction = classePredictions[0];
                
                // è¤‡æ•°ã®æ¤œå‡ºãŒã‚ã‚‹å ´åˆã¯ä¿¡é ¼åº¦ã‚’ãƒ–ãƒ¼ã‚¹ãƒˆ
                if (classePredictions.length > 1) {
                    bestPrediction.score = Math.min(0.99, bestPrediction.score * 1.2);
                }
                
                result.push(bestPrediction);
            });
            
            return result;
        }
        
        // å‹•çš„ä¿¡é ¼åº¦é–¾å€¤è¨­å®š
        function getDynamicThreshold(className) {
            // è¨¼æ‹ ã¨ã—ã¦é‡è¦ãªç‰©ä½“ã¯é–¾å€¤ã‚’ä¸‹ã’ã‚‹ï¼ˆå¤§å¹…æ‹¡å¼µç‰ˆï¼‰
            const evidenceThresholds = {
                // é »ç¹ã«æ¤œå‡ºã•ã‚Œã‚‹ç‰©ä½“ï¼ˆé«˜ã„é–¾å€¤ï¼‰
                'person': 0.45,
                'car': 0.50,
                'tv': 0.40,
                
                // èª¿ç†å®¶é›»ï¼ˆä¸­ç¨‹åº¦ã®é–¾å€¤ï¼‰
                'microwave': 0.25,
                'refrigerator': 0.30,
                'toaster': 0.20,
                'blender': 0.20,
                'coffee maker': 0.25,
                'oven': 0.30,
                'stove': 0.25,
                
                // åŠ ç†±ãƒ»èª¿ç†å™¨å…·ï¼ˆä½ã„é–¾å€¤ï¼‰
                'pan': 0.20,
                'pot': 0.20,
                'steamer': 0.20,
                
                // ã‚­ãƒƒãƒãƒ³ãƒ„ãƒ¼ãƒ«ï¼ˆéå¸¸ã«ä½ã„é–¾å€¤ï¼‰
                'knife': 0.15,
                'cutting board': 0.20,
                'ladle': 0.15,
                'tongs': 0.15,
                'measuring spoon': 0.12,
                'whisk': 0.15,
                'peeler': 0.12,
                'grater': 0.15,
                
                // é£Ÿå™¨ãƒ»ã‚«ãƒˆãƒ©ãƒªãƒ¼ï¼ˆä½ã„é–¾å€¤ï¼‰
                'plate': 0.20,
                'bowl': 0.18,
                'cup': 0.20,
                'wine glass': 0.18,
                'chopsticks': 0.12,
                'fork': 0.15,
                'spoon': 0.15,
                
                // ä¿å­˜ãƒ»ãƒ©ãƒƒãƒ”ãƒ³ã‚°ç”¨å“ï¼ˆä½ã„é–¾å€¤ï¼‰
                'tupperware': 0.18,
                'plastic bag': 0.15,
                'aluminum foil': 0.12,
                'food wrap': 0.12,
                
                // æ¸…æƒãƒ»è¡›ç”Ÿç”¨å“ï¼ˆä½ã„é–¾å€¤ï¼‰
                'detergent': 0.18,
                'sponge': 0.15,
                'spray bottle': 0.15,
                'garbage bag': 0.18,
                
                // èª¿å‘³æ–™ãƒ»ã‚¹ãƒ‘ã‚¤ã‚¹ï¼ˆéå¸¸ã«ä½ã„é–¾å€¤ï¼‰
                'salt': 0.12,
                'sugar': 0.12,
                'soy sauce': 0.15,
                'olive oil': 0.15,
                'pepper': 0.12,
                
                // ç”Ÿé®®é£Ÿå“ï¼ˆä½ã„é–¾å€¤ï¼‰
                'apple': 0.20,
                'banana': 0.18,
                'orange': 0.20,
                'carrot': 0.18,
                'onion': 0.18,
                'potato': 0.18,
                'tomato': 0.20,
                
                // é£²æ–™ãƒ»ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ï¼ˆä½ã„é–¾å€¤ï¼‰
                'beer': 0.20,
                'wine': 0.22,
                'juice': 0.18,
                'coffee': 0.18,
                'tea': 0.18,
                'milk': 0.20,
                
                // åŠ å·¥ãƒ»ä¿å­˜é£Ÿå“ï¼ˆä½ã„é–¾å€¤ï¼‰
                'canned food': 0.20,
                'instant noodles': 0.18,
                'bread': 0.20,
                
                // è“å­ãƒ»ã‚¹ãƒŠãƒƒã‚¯ï¼ˆä½ã„é–¾å€¤ï¼‰
                'chocolate': 0.18,
                'cookies': 0.18,
                'potato chips': 0.18,
                
                // æ—¢å­˜ã®è¨¼æ‹ ç‰©ä½“
                'book': 0.25,
                'cell phone': 0.20,
                'laptop': 0.30,
                'bottle': 0.25,
                'chair': 0.35,
                'clock': 0.20,
                'potted plant': 0.30,
                'bag': 0.25,
                'backpack': 0.25,
                'handbag': 0.25,
                'scissors': 0.20,
                'remote': 0.25,
                'mouse': 0.20,
                'keyboard': 0.25,
                'vase': 0.25,
                'couch': 0.40,
                'bed': 0.35,
                'dining table': 0.35
            };
            
            return evidenceThresholds[className] || 0.30;
        }
        
        // å…¨æ¤œå‡ºçµæœã®è¡¨ç¤ºï¼ˆé‡è¤‡é™¤å¤–æ©Ÿèƒ½ä»˜ãï¼‰
        function drawAllDetections(predictions, ctx) {
            // æ—¢ã«åé›†æ¸ˆã¿ã®è¨¼æ‹ ã‚¿ã‚¤ãƒ—ã‚’å–å¾—
            const collectedTypes = gameState.evidence.map(e => e.type);
            
            predictions.forEach((prediction, index) => {
                const [x, y, width, height] = prediction.bbox;
                const className = prediction.class;
                const confidence = Math.round(prediction.score * 100);
                const japaneseName = objectNames[className] || className;
                
                // è¨¼æ‹ ç‰©ä½“ã‹ã©ã†ã‹ã¨ä¿¡é ¼åº¦é–¾å€¤ã‚’ãƒã‚§ãƒƒã‚¯
                const isEvidence = evidenceHints[className];
                const isCollected = collectedTypes.includes(className);
                const dynamicThreshold = getDynamicThreshold(className);
                const meetsThreshold = confidence >= dynamicThreshold;
                
                console.log(`${className}: ä¿¡é ¼åº¦${confidence}%, é–¾å€¤${Math.round(dynamicThreshold*100)}%, è¨¼æ‹ ç‰©ä½“: ${isEvidence}, é–¾å€¤æº€è¶³: ${meetsThreshold}`);
                
                let boxColor, alpha;
                if (isEvidence && meetsThreshold && !isCollected) {
                    // æ–°ã—ã„æœ‰åŠ¹ãªè¨¼æ‹ : ç·‘è‰²
                    boxColor = '#00ff00';
                    alpha = '0.8';
                } else if (isEvidence && isCollected) {
                    // æ—¢ã«åé›†æ¸ˆã¿ã®è¨¼æ‹ : é»„è‰²
                    boxColor = '#ffaa00';
                    alpha = '0.6';
                } else if (isEvidence && !meetsThreshold) {
                    // è¨¼æ‹ ç‰©ä½“ã ãŒä¿¡é ¼åº¦ä¸è¶³: ã‚ªãƒ¬ãƒ³ã‚¸è‰²
                    boxColor = '#ff6600';
                    alpha = '0.5';
                } else {
                    // ä¸€èˆ¬ç‰©ä½“: ç°è‰²
                    boxColor = '#666666';
                    alpha = '0.4';
                }
                
                // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹
                ctx.strokeStyle = boxColor;
                ctx.lineWidth = (isEvidence && meetsThreshold) ? 3 : 1;
                ctx.setLineDash((isEvidence && meetsThreshold && !isCollected) ? [] : [5, 5]);
                ctx.strokeRect(x, y, width, height);
                
                // ãƒ©ãƒ™ãƒ«èƒŒæ™¯
                let labelText = `${japaneseName} ${confidence}%`;
                if (isCollected) {
                    labelText += ' âœ“'; // ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã§åé›†æ¸ˆã¿ã‚’è¡¨ç¤º
                } else if (isEvidence && !meetsThreshold) {
                    labelText += ` (è¦${Math.round(dynamicThreshold*100)}%+)`; // å¿…è¦ãªé–¾å€¤ã‚’è¡¨ç¤º
                }
                
                ctx.font = '14px Arial';
                const textWidth = ctx.measureText(labelText).width;
                
                ctx.fillStyle = boxColor + Math.round(255 * parseFloat(alpha)).toString(16).padStart(2, '0');
                ctx.fillRect(x, y - 25, textWidth + 10, 20);
                
                // ãƒ©ãƒ™ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ
                ctx.fillStyle = '#ffffff';
                ctx.fillText(labelText, x + 5, y - 10);
                
                // ç ´ç·šã‚’ãƒªã‚»ãƒƒãƒˆ
                ctx.setLineDash([]);
            });
        }
        
        // é€£ç¶šæ¤œå‡ºãƒ¢ãƒ¼ãƒ‰ï¼ˆç„¡åŠ¹åŒ–æ¸ˆã¿ï¼‰
        let continuousDetectionInterval = null;
        
        function startContinuousDetection() {
            // ã‚¿ãƒƒãƒ—ãƒ™ãƒ¼ã‚¹ã®æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ç„¡åŠ¹åŒ–
            console.log('é€£ç¶šæ¤œå‡ºãƒ¢ãƒ¼ãƒ‰ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ - ã‚¿ãƒƒãƒ—ã—ã¦ç‰©ä½“ã‚’æ¤œçŸ¥ã—ã¦ãã ã•ã„');
        }
        
        function stopContinuousDetection() {
            if (continuousDetectionInterval) {
                clearInterval(continuousDetectionInterval);
                continuousDetectionInterval = null;
            }
        }
        
        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®å‡¦ç†
        window.addEventListener('beforeunload', () => {
            stopContinuousDetection();
            if (gameState.stream) {
                gameState.stream.getTracks().forEach(track => track.stop());
            }
            audioManager.stopBGM();
        });
    </script>
</body>
</html>